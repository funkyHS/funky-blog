<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【2. Mongodb提高】 | Funky&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/funkyblog/logo.jpg">
    <meta name="description" content="Funky的个人技术博客">
    
    <link rel="preload" href="/funkyblog/assets/css/0.styles.c5671824.css" as="style"><link rel="preload" href="/funkyblog/assets/js/app.a24b3efd.js" as="script"><link rel="preload" href="/funkyblog/assets/js/2.3aea1f50.js" as="script"><link rel="preload" href="/funkyblog/assets/js/77.bd56a926.js" as="script"><link rel="prefetch" href="/funkyblog/assets/js/10.fdb72551.js"><link rel="prefetch" href="/funkyblog/assets/js/100.322ef7c3.js"><link rel="prefetch" href="/funkyblog/assets/js/101.7adabe50.js"><link rel="prefetch" href="/funkyblog/assets/js/102.b672d5b4.js"><link rel="prefetch" href="/funkyblog/assets/js/103.cbd5f57f.js"><link rel="prefetch" href="/funkyblog/assets/js/104.98c6bdcb.js"><link rel="prefetch" href="/funkyblog/assets/js/105.51f7efcb.js"><link rel="prefetch" href="/funkyblog/assets/js/106.bcdfddc5.js"><link rel="prefetch" href="/funkyblog/assets/js/107.000a9752.js"><link rel="prefetch" href="/funkyblog/assets/js/108.92133c7f.js"><link rel="prefetch" href="/funkyblog/assets/js/109.249e3002.js"><link rel="prefetch" href="/funkyblog/assets/js/11.8d7a0728.js"><link rel="prefetch" href="/funkyblog/assets/js/110.a116e6e3.js"><link rel="prefetch" href="/funkyblog/assets/js/111.5d78ef12.js"><link rel="prefetch" href="/funkyblog/assets/js/112.2c266219.js"><link rel="prefetch" href="/funkyblog/assets/js/113.480d3824.js"><link rel="prefetch" href="/funkyblog/assets/js/114.fa1b4ab2.js"><link rel="prefetch" href="/funkyblog/assets/js/115.d65cb78a.js"><link rel="prefetch" href="/funkyblog/assets/js/116.33a2e878.js"><link rel="prefetch" href="/funkyblog/assets/js/117.bbd07ef4.js"><link rel="prefetch" href="/funkyblog/assets/js/118.0dedd5d9.js"><link rel="prefetch" href="/funkyblog/assets/js/119.5a13d359.js"><link rel="prefetch" href="/funkyblog/assets/js/12.84a022d2.js"><link rel="prefetch" href="/funkyblog/assets/js/120.6d8406bc.js"><link rel="prefetch" href="/funkyblog/assets/js/121.1535eb29.js"><link rel="prefetch" href="/funkyblog/assets/js/122.25226b03.js"><link rel="prefetch" href="/funkyblog/assets/js/123.00d7c304.js"><link rel="prefetch" href="/funkyblog/assets/js/124.16802c94.js"><link rel="prefetch" href="/funkyblog/assets/js/125.541331b4.js"><link rel="prefetch" href="/funkyblog/assets/js/126.8eec9a18.js"><link rel="prefetch" href="/funkyblog/assets/js/127.d14ed3d3.js"><link rel="prefetch" href="/funkyblog/assets/js/13.fe7b989e.js"><link rel="prefetch" href="/funkyblog/assets/js/14.06c2893e.js"><link rel="prefetch" href="/funkyblog/assets/js/15.7db30254.js"><link rel="prefetch" href="/funkyblog/assets/js/16.f5c8a3a0.js"><link rel="prefetch" href="/funkyblog/assets/js/17.ee25e8b2.js"><link rel="prefetch" href="/funkyblog/assets/js/18.138ba97b.js"><link rel="prefetch" href="/funkyblog/assets/js/19.7b046ac4.js"><link rel="prefetch" href="/funkyblog/assets/js/20.93aa8f6a.js"><link rel="prefetch" href="/funkyblog/assets/js/21.b422e4c4.js"><link rel="prefetch" href="/funkyblog/assets/js/22.4b4fa0d1.js"><link rel="prefetch" href="/funkyblog/assets/js/23.3135691d.js"><link rel="prefetch" href="/funkyblog/assets/js/24.5ed690d9.js"><link rel="prefetch" href="/funkyblog/assets/js/25.599c60f6.js"><link rel="prefetch" href="/funkyblog/assets/js/26.9388b7c2.js"><link rel="prefetch" href="/funkyblog/assets/js/27.a17039b1.js"><link rel="prefetch" href="/funkyblog/assets/js/28.51a65ac9.js"><link rel="prefetch" href="/funkyblog/assets/js/29.ca8f9960.js"><link rel="prefetch" href="/funkyblog/assets/js/3.90f0fac9.js"><link rel="prefetch" href="/funkyblog/assets/js/30.c93ba89f.js"><link rel="prefetch" href="/funkyblog/assets/js/31.1739efda.js"><link rel="prefetch" href="/funkyblog/assets/js/32.3d6133c5.js"><link rel="prefetch" href="/funkyblog/assets/js/33.ea1b693d.js"><link rel="prefetch" href="/funkyblog/assets/js/34.f5f68409.js"><link rel="prefetch" href="/funkyblog/assets/js/35.fe8276f9.js"><link rel="prefetch" href="/funkyblog/assets/js/36.7dfbbc31.js"><link rel="prefetch" href="/funkyblog/assets/js/37.38292e55.js"><link rel="prefetch" href="/funkyblog/assets/js/38.814bd863.js"><link rel="prefetch" href="/funkyblog/assets/js/39.ff4fbd9f.js"><link rel="prefetch" href="/funkyblog/assets/js/4.bf89a90b.js"><link rel="prefetch" href="/funkyblog/assets/js/40.b78c54dc.js"><link rel="prefetch" href="/funkyblog/assets/js/41.f17fe040.js"><link rel="prefetch" href="/funkyblog/assets/js/42.83583d5d.js"><link rel="prefetch" href="/funkyblog/assets/js/43.deed3fdd.js"><link rel="prefetch" href="/funkyblog/assets/js/44.8033ac93.js"><link rel="prefetch" href="/funkyblog/assets/js/45.78c09822.js"><link rel="prefetch" href="/funkyblog/assets/js/46.dc92e91d.js"><link rel="prefetch" href="/funkyblog/assets/js/47.58c20506.js"><link rel="prefetch" href="/funkyblog/assets/js/48.03e8e813.js"><link rel="prefetch" href="/funkyblog/assets/js/49.51f46791.js"><link rel="prefetch" href="/funkyblog/assets/js/5.f6f2e860.js"><link rel="prefetch" href="/funkyblog/assets/js/50.d62f902a.js"><link rel="prefetch" href="/funkyblog/assets/js/51.2f77c15c.js"><link rel="prefetch" href="/funkyblog/assets/js/52.14d3dba9.js"><link rel="prefetch" href="/funkyblog/assets/js/53.9598cf79.js"><link rel="prefetch" href="/funkyblog/assets/js/54.669e4f25.js"><link rel="prefetch" href="/funkyblog/assets/js/55.aeb878b8.js"><link rel="prefetch" href="/funkyblog/assets/js/56.23f25070.js"><link rel="prefetch" href="/funkyblog/assets/js/57.f048233b.js"><link rel="prefetch" href="/funkyblog/assets/js/58.f3967f69.js"><link rel="prefetch" href="/funkyblog/assets/js/59.62f0670e.js"><link rel="prefetch" href="/funkyblog/assets/js/6.6d922041.js"><link rel="prefetch" href="/funkyblog/assets/js/60.016ba18c.js"><link rel="prefetch" href="/funkyblog/assets/js/61.b5d2cff8.js"><link rel="prefetch" href="/funkyblog/assets/js/62.ac5f87fe.js"><link rel="prefetch" href="/funkyblog/assets/js/63.d9a60137.js"><link rel="prefetch" href="/funkyblog/assets/js/64.b591a667.js"><link rel="prefetch" href="/funkyblog/assets/js/65.e768c8e9.js"><link rel="prefetch" href="/funkyblog/assets/js/66.5f46813d.js"><link rel="prefetch" href="/funkyblog/assets/js/67.02b3f46c.js"><link rel="prefetch" href="/funkyblog/assets/js/68.676ba975.js"><link rel="prefetch" href="/funkyblog/assets/js/69.e031cc98.js"><link rel="prefetch" href="/funkyblog/assets/js/7.7a61e41b.js"><link rel="prefetch" href="/funkyblog/assets/js/70.94a805bd.js"><link rel="prefetch" href="/funkyblog/assets/js/71.281fda5b.js"><link rel="prefetch" href="/funkyblog/assets/js/72.290763cf.js"><link rel="prefetch" href="/funkyblog/assets/js/73.21b036b0.js"><link rel="prefetch" href="/funkyblog/assets/js/74.df7e87b8.js"><link rel="prefetch" href="/funkyblog/assets/js/75.a73c1199.js"><link rel="prefetch" href="/funkyblog/assets/js/76.44658040.js"><link rel="prefetch" href="/funkyblog/assets/js/78.09a51bc3.js"><link rel="prefetch" href="/funkyblog/assets/js/79.cb143284.js"><link rel="prefetch" href="/funkyblog/assets/js/8.708c7e46.js"><link rel="prefetch" href="/funkyblog/assets/js/80.f134bc8b.js"><link rel="prefetch" href="/funkyblog/assets/js/81.12483621.js"><link rel="prefetch" href="/funkyblog/assets/js/82.e41901b3.js"><link rel="prefetch" href="/funkyblog/assets/js/83.5c039041.js"><link rel="prefetch" href="/funkyblog/assets/js/84.c4c06788.js"><link rel="prefetch" href="/funkyblog/assets/js/85.bced8698.js"><link rel="prefetch" href="/funkyblog/assets/js/86.5315ed66.js"><link rel="prefetch" href="/funkyblog/assets/js/87.4ea61a5c.js"><link rel="prefetch" href="/funkyblog/assets/js/88.aa62f043.js"><link rel="prefetch" href="/funkyblog/assets/js/89.0eb25b80.js"><link rel="prefetch" href="/funkyblog/assets/js/9.e076e28d.js"><link rel="prefetch" href="/funkyblog/assets/js/90.7f136876.js"><link rel="prefetch" href="/funkyblog/assets/js/91.12c27e63.js"><link rel="prefetch" href="/funkyblog/assets/js/92.e2ffad27.js"><link rel="prefetch" href="/funkyblog/assets/js/93.a08e3a15.js"><link rel="prefetch" href="/funkyblog/assets/js/94.977d3ede.js"><link rel="prefetch" href="/funkyblog/assets/js/95.f8e1328d.js"><link rel="prefetch" href="/funkyblog/assets/js/96.c119e0f7.js"><link rel="prefetch" href="/funkyblog/assets/js/97.e483280d.js"><link rel="prefetch" href="/funkyblog/assets/js/98.0f1eb7a4.js"><link rel="prefetch" href="/funkyblog/assets/js/99.7813329f.js">
    <link rel="stylesheet" href="/funkyblog/assets/css/0.styles.c5671824.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/funkyblog/" class="home-link router-link-active"><img src="/funkyblog/logo.jpg" alt="Funky's blog" class="logo"> <span class="site-name can-hide">Funky's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/funkyblog/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/funkyblog/flutter/" class="nav-link">
  Flutter
</a></div><div class="nav-item"><a href="/funkyblog/server/" class="nav-link router-link-active">
  Server
</a></div><div class="nav-item"><a href="/funkyblog/web/" class="nav-link">
  Web
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/funkyblog/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/funkyblog/flutter/" class="nav-link">
  Flutter
</a></div><div class="nav-item"><a href="/funkyblog/server/" class="nav-link router-link-active">
  Server
</a></div><div class="nav-item"><a href="/funkyblog/web/" class="nav-link">
  Web
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JDBC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MongoDB</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/funkyblog/server/mongodb/1-mongodb-base/" class="sidebar-link">【1. Mongodb基础】</a></li><li><a href="/funkyblog/server/mongodb/2-mongodb-improve/" aria-current="page" class="active sidebar-link">【2. Mongodb提高】</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_1-分页-排序" class="sidebar-link">1. 分页&amp;排序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_1-1-排序" class="sidebar-link">1.1 排序</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_1-2-limit与skip方法" class="sidebar-link">1.2 Limit与Skip方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_2-聚合查询" class="sidebar-link">2. 聚合查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_2-1-语法" class="sidebar-link">2.1 语法</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_2-2-常用管道" class="sidebar-link">2.2 常用管道</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_2-3-常用表达式" class="sidebar-link">2.3 常用表达式</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_1-练习-统计男生、女生的总年龄" class="sidebar-link" style="padding-left:3rem;">1）练习：统计男生、女生的总年龄</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_2-练习-统计男生、女生的总人数" class="sidebar-link" style="padding-left:3rem;">2）练习：统计男生、女生的总人数</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_3-练习-求学生总数和平均年龄" class="sidebar-link" style="padding-left:3rem;">3）练习：求学生总数和平均年龄</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_4-练习-查询男生、女生人数-按人数升序" class="sidebar-link" style="padding-left:3rem;">4）练习：查询男生、女生人数，按人数升序</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_3-优化索引" class="sidebar-link">3. 优化索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_3-1-索引优缺点" class="sidebar-link">3.1 索引优缺点</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_3-2-语法" class="sidebar-link">3.2 语法</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_3-3-练习" class="sidebar-link">3.3 练习</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_1-练习-给name添加普通索引" class="sidebar-link" style="padding-left:3rem;">1）练习：给name添加普通索引</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_2-练习-删除name索引" class="sidebar-link" style="padding-left:3rem;">2）练习：删除name索引</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_3-练习-给name创建索引并起名funky" class="sidebar-link" style="padding-left:3rem;">3）练习：给name创建索引并起名funky</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_4-练习-给name和age添加组合索引-一次性给两个字段建立索引" class="sidebar-link" style="padding-left:3rem;">4）练习: 给name和age添加组合索引（一次性给两个字段建立索引）</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_3-4-分析索引" class="sidebar-link">3.4 分析索引</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_4-权限机制" class="sidebar-link">4. 权限机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_4-1-创建账号" class="sidebar-link">4.1 创建账号</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_4-2-角色种类" class="sidebar-link">4.2 角色种类</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_4-3-角色说明" class="sidebar-link">4.3 角色说明</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_4-4-开启验证模式-指用户需要输入账号密码才能登陆使用" class="sidebar-link">4.4 开启验证模式（指用户需要输入账号密码才能登陆使用）</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_1-添加超级管理员" class="sidebar-link" style="padding-left:3rem;">1）添加超级管理员</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_2-退出mongod-使用-auth重新进入mongod" class="sidebar-link" style="padding-left:3rem;">2）退出mongod,使用--auth重新进入mongod</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_3-启动服务-登录测试" class="sidebar-link" style="padding-left:3rem;">3）启动服务 登录测试</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_4-5-练习" class="sidebar-link">4.5 练习</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#添加用户shop1可以读shop数据库-添加用户shop2可以读写shop数据库" class="sidebar-link" style="padding-left:3rem;">添加用户shop1可以读shop数据库，添加用户shop2可以读写shop数据库</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_5-备份还原" class="sidebar-link">5. 备份还原</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_5-1-备份数据库-mongodump" class="sidebar-link">5.1 备份数据库 mongodump</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_5-2-还原数据库mongorestore" class="sidebar-link">5.2 还原数据库mongorestore</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_6-实战可视化管理工具" class="sidebar-link">6. 实战可视化管理工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_6-1-adminmongo-网页端管理工具" class="sidebar-link">6.1 adminMongo 网页端管理工具</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_6-2-robo-3t-客户端软件工具" class="sidebar-link">6.2 Robo 3T 客户端软件工具</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_7-express与mongoose" class="sidebar-link">7. express与mongoose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_7-1-mongoose简介-schema-model" class="sidebar-link">7.1 mongoose简介(schema&amp;model)</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_7-2-mongoose使用" class="sidebar-link">7.2 mongoose使用</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_7-3-使用express进行接口开发" class="sidebar-link">7.3 使用express进行接口开发</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#_8-实战接口文档开发apidoc" class="sidebar-link">8. 实战接口文档开发apiDoc</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/mongodb/2-mongodb-improve/#参考" class="sidebar-link">参考</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringSecurity</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#_1-分页-排序">1. 分页&amp;排序</a><ul><li><a href="#_1-1-排序">1.1 排序</a></li><li><a href="#_1-2-limit与skip方法">1.2 Limit与Skip方法</a></li></ul></li><li><a href="#_2-聚合查询">2. 聚合查询</a><ul><li><a href="#_2-1-语法">2.1 语法</a></li><li><a href="#_2-2-常用管道">2.2 常用管道</a></li><li><a href="#_2-3-常用表达式">2.3 常用表达式</a></li></ul></li><li><a href="#_3-优化索引">3. 优化索引</a><ul><li><a href="#_3-1-索引优缺点">3.1 索引优缺点</a></li><li><a href="#_3-2-语法">3.2 语法</a></li><li><a href="#_3-3-练习">3.3 练习</a></li><li><a href="#_3-4-分析索引">3.4 分析索引</a></li></ul></li><li><a href="#_4-权限机制">4. 权限机制</a><ul><li><a href="#_4-1-创建账号">4.1 创建账号</a></li><li><a href="#_4-2-角色种类">4.2 角色种类</a></li><li><a href="#_4-3-角色说明">4.3 角色说明</a></li><li><a href="#_4-4-开启验证模式-指用户需要输入账号密码才能登陆使用">4.4 开启验证模式（指用户需要输入账号密码才能登陆使用）</a></li><li><a href="#_4-5-练习">4.5 练习</a></li></ul></li><li><a href="#_5-备份还原">5. 备份还原</a><ul><li><a href="#_5-1-备份数据库-mongodump">5.1 备份数据库 mongodump</a></li><li><a href="#_5-2-还原数据库mongorestore">5.2 还原数据库mongorestore</a></li></ul></li><li><a href="#_6-实战可视化管理工具">6. 实战可视化管理工具</a><ul><li><a href="#_6-1-adminmongo-网页端管理工具">6.1 adminMongo 网页端管理工具</a></li><li><a href="#_6-2-robo-3t-客户端软件工具">6.2 Robo 3T 客户端软件工具</a></li></ul></li><li><a href="#_7-express与mongoose">7. express与mongoose</a><ul><li><a href="#_7-1-mongoose简介-schema-model">7.1 mongoose简介(schema&amp;model)</a></li><li><a href="#_7-2-mongoose使用">7.2 mongoose使用</a></li><li><a href="#_7-3-使用express进行接口开发">7.3 使用express进行接口开发</a></li></ul></li><li><a href="#_8-实战接口文档开发apidoc">8. 实战接口文档开发apiDoc</a></li><li><a href="#参考">参考</a></li></ul></div><p></p> <h2 id="_1-分页-排序"><a href="#_1-分页-排序" class="header-anchor">#</a> 1. 分页&amp;排序</h2> <ul><li>准备数据</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>use test3
db.c1.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>_id:1, name:<span class="token string">&quot;a&quot;</span>, sex:1, age:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.c1.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>_id:2, name:<span class="token string">&quot;a&quot;</span>, sex:1, age:2<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.c1.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>_id:3, name:<span class="token string">&quot;b&quot;</span>, sex:2, age:3<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.c1.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>_id:4, name:<span class="token string">&quot;c&quot;</span>, sex:2, age:4<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.c1.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>_id:5, name:<span class="token string">&quot;d&quot;</span>, sex:2, age:5<span class="token punctuation">}</span><span class="token punctuation">)</span>

db.c1.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_1-1-排序"><a href="#_1-1-排序" class="header-anchor">#</a> 1.1 排序</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 语法：db.集合名.find().sort(JSON数据)</span>
<span class="token comment"># 说明：键-就是要排序的列/字段、值：1 升序  -1 降序</span>

<span class="token comment"># 按照年龄降序｜升序排列</span>
db.c1.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{</span>age: -1<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.c1.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{</span>age: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_1-2-limit与skip方法"><a href="#_1-2-limit与skip方法" class="header-anchor">#</a> 1.2 Limit与Skip方法</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 语法：db.集合名.find().sort().skip(数字).limit(数字)</span>
<span class="token comment"># 说明：skip跳过指定数量（可选），limit限制查询的数量</span>

<span class="token comment"># 降序查询2条数据</span>
db.c1.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{</span>age: -1<span class="token punctuation">}</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># 降序跳过2条并查询2条</span>
db.c1.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{</span>age: -1<span class="token punctuation">}</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>实战分页</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 需求：数据库 1  - 10数据，每页显示两条（5页）</span>
<span class="token comment"># 语法：db.集合名.find().skip().limit(2)</span>
<span class="token comment"># skip计算公式：（当前页 - 1） * 每页显示条数</span>
</code></pre></div><hr> <h2 id="_2-聚合查询"><a href="#_2-聚合查询" class="header-anchor">#</a> 2. 聚合查询</h2> <ul><li>聚合查询: 把数据聚起来，然后统计</li></ul> <h3 id="_2-1-语法"><a href="#_2-1-语法" class="header-anchor">#</a> 2.1 语法</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>db.集合名称.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>管道:<span class="token punctuation">{</span>表达式<span class="token punctuation">}</span><span class="token punctuation">}</span>
     <span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-2-常用管道"><a href="#_2-2-常用管道" class="header-anchor">#</a> 2.2 常用管道</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token variable">$group</span> 将集合中的文档分组，用于统计结果
<span class="token variable">$match</span> 过滤数据，只要输出符合条件的文档
<span class="token variable">$sort</span>  聚合数据进一步排序
<span class="token variable">$skip</span>  跳过指定文档数
<span class="token variable">$limit</span> 限制集合数据返回文档数
<span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre></div><h3 id="_2-3-常用表达式"><a href="#_2-3-常用表达式" class="header-anchor">#</a> 2.3 常用表达式</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token variable">$sum</span>  总和  <span class="token variable">$sum</span>:1同count表示统计
<span class="token variable">$avg</span>  平均
<span class="token variable">$min</span>  最小值
<span class="token variable">$max</span>  最大值
</code></pre></div><h4 id="_1-练习-统计男生、女生的总年龄"><a href="#_1-练习-统计男生、女生的总年龄" class="header-anchor">#</a> 1）练习：统计男生、女生的总年龄</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>db.c1.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$group</span>:<span class="token punctuation">{</span>
            _id: <span class="token string">&quot;<span class="token variable">$sex</span>&quot;</span>, <span class="token comment"># 按性别分组</span>
            rs: <span class="token punctuation">{</span> <span class="token variable">$sum</span><span class="token builtin class-name">:</span> <span class="token string">&quot;<span class="token variable">$age</span>&quot;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 输出：</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&quot;rs&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;rs&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">12</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-练习-统计男生、女生的总人数"><a href="#_2-练习-统计男生、女生的总人数" class="header-anchor">#</a> 2）练习：统计男生、女生的总人数</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>db.c1.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$group</span>:<span class="token punctuation">{</span>
            _id: <span class="token string">&quot;<span class="token variable">$sex</span>&quot;</span>,
            rs: <span class="token punctuation">{</span> <span class="token variable">$sum</span><span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 输出：</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&quot;rs&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;rs&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-练习-求学生总数和平均年龄"><a href="#_3-练习-求学生总数和平均年龄" class="header-anchor">#</a> 3）练习：求学生总数和平均年龄</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>db.c1.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$group</span>:<span class="token punctuation">{</span>
            _id: null,
            total_num: <span class="token punctuation">{</span> <span class="token variable">$sum</span>:1 <span class="token punctuation">}</span>,
            total_avg: <span class="token punctuation">{</span> <span class="token variable">$avg</span><span class="token builtin class-name">:</span> <span class="token string">&quot;<span class="token variable">$age</span>&quot;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 输出</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> null, <span class="token string">&quot;total_num&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">5</span>, <span class="token string">&quot;total_avg&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-练习-查询男生、女生人数-按人数升序"><a href="#_4-练习-查询男生、女生人数-按人数升序" class="header-anchor">#</a> 4）练习：查询男生、女生人数，按人数升序</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>db.c1.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token variable">$group</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>_id: <span class="token string">&quot;<span class="token variable">$sex</span>&quot;</span>,rs: <span class="token punctuation">{</span><span class="token variable">$sum</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,
    <span class="token punctuation">{</span><span class="token variable">$sort</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>rs: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 输出</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&quot;rs&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;rs&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
</code></pre></div><hr> <h2 id="_3-优化索引"><a href="#_3-优化索引" class="header-anchor">#</a> 3. 优化索引</h2> <ul><li>索引是一种排序好的便于快速查询的数据结构, 帮助数据库高效的查询数据
<br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/5.png" width="600"></li></ul> <h3 id="_3-1-索引优缺点"><a href="#_3-1-索引优缺点" class="header-anchor">#</a> 3.1 索引优缺点</h3> <ul><li>优点
<ul><li>提高数据查询的效率，降低数据库的IO成本</li> <li>通过索引对数据进行排序，降低数据排序的成本，降低CPU的消耗</li></ul></li> <li>缺点
<ul><li>占用磁盘空间</li> <li>大量索引影响SQL语句效率，因为每次插入和修改数据都需要更新索引</li></ul></li></ul> <h3 id="_3-2-语法"><a href="#_3-2-语法" class="header-anchor">#</a> 3.2 语法</h3> <ul><li>创建索引语法：<code>db.集合名.createIndex(待创建索引的列 [,额外选项])</code></li> <li>参数：
<ul><li>待创建索引的列：<code>{键:1,...,键:-1}</code></li> <li>说明：1升序 -1降序 例如<code>{age:1}</code>表示创建age索引并按照升序的方式存储</li> <li>额外选项：设置索引的名称或者唯一索引等等</li></ul></li> <li>删除索引语法：
<ul><li>全部删除：<code>db.集合名.dropIndexes()</code></li> <li>删除指定：<code>db.集合名.dropIndex(索引名)</code></li></ul></li> <li>查看索引语法：<code>db.集合名.getIndexes()</code></li></ul> <h3 id="_3-3-练习"><a href="#_3-3-练习" class="header-anchor">#</a> 3.3 练习</h3> <ul><li>准备100000条数据</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>use test5

for<span class="token punctuation">(</span>var <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">100000</span><span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db.c1.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token builtin class-name">:</span><span class="token string">&quot;aaa&quot;</span>+i,<span class="token string">&quot;age&quot;</span>:i<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

db.c1.count<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_1-练习-给name添加普通索引"><a href="#_1-练习-给name添加普通索引" class="header-anchor">#</a> 1）练习：给name添加普通索引</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 添加索引</span>
db.c1.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>name:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 输出：</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;createdCollectionAutomatically&quot;</span> <span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;numIndexesBefore&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
        <span class="token string">&quot;numIndexesAfter&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
        <span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>

<span class="token comment"># 查看索引</span>
db.c1.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 输出：</span>
    <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;v&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
            <span class="token string">&quot;key&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;_id_&quot;</span>, <span class="token comment"># 索引名字</span>
            <span class="token string">&quot;ns&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;test5.c1&quot;</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span>
            <span class="token string">&quot;v&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
            <span class="token string">&quot;key&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token comment"># 表示给哪个列设置了索引</span>
                <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;name_1&quot;</span>, <span class="token comment"># 索引名字</span>
            <span class="token string">&quot;ns&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;test5.c1&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
</code></pre></div><h4 id="_2-练习-删除name索引"><a href="#_2-练习-删除name索引" class="header-anchor">#</a> 2）练习：删除name索引</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>db.c1.dropIndex<span class="token punctuation">(</span><span class="token string">'name_1'</span><span class="token punctuation">)</span>
<span class="token comment"># 输出</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;nIndexesWas&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-练习-给name创建索引并起名funky"><a href="#_3-练习-给name创建索引并起名funky" class="header-anchor">#</a> 3）练习：给name创建索引并起名funky</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>db.c1.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>name:1<span class="token punctuation">}</span>, <span class="token punctuation">{</span>name: <span class="token string">&quot;funky&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_4-练习-给name和age添加组合索引-一次性给两个字段建立索引"><a href="#_4-练习-给name和age添加组合索引-一次性给两个字段建立索引" class="header-anchor">#</a> 4）练习: 给name和age添加组合索引（一次性给两个字段建立索引）</h4> <div class="language- extra-class"><pre><code>- db.集合名.createIndex({键1:方式,键2:方式})
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>db.c1.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>name:1, age:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 输出</span>
<span class="token punctuation">[</span>
	<span class="token comment"># ...</span>
	<span class="token punctuation">{</span>
		<span class="token string">&quot;v&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
		<span class="token string">&quot;key&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
			<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
		<span class="token punctuation">}</span>,
		<span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;name_1_age_1&quot;</span>,
		<span class="token string">&quot;ns&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;test5.c1&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li>练习5: 删除全部索引</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 系统的不会被删除</span>
db.c1.dropIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>练习6: 设置唯一索引</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>db.c1.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>name:1<span class="token punctuation">}</span>, <span class="token punctuation">{</span>unique: <span class="token string">&quot;name&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 如果插入的name已经在集合中，那么不能重复插入</span>
</code></pre></div><h3 id="_3-4-分析索引"><a href="#_3-4-分析索引" class="header-anchor">#</a> 3.4 分析索引</h3> <ul><li><p>语法：<code>db.c1.find().explain('executionStats')</code></p></li> <li><p>索引扫描方式：</p> <ul><li>COLLSCAN：全表扫描</li> <li>IXSCAN：索引扫描</li> <li>FETCH：根据索引去检索指定document</li></ul></li> <li><p>age未添加索引的情况</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>db.c1.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:500<span class="token punctuation">}</span><span class="token punctuation">)</span>.explain<span class="token punctuation">(</span><span class="token string">'executionStats'</span><span class="token punctuation">)</span>
<span class="token comment"># 输出</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;queryPlanner&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;plannerVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
		<span class="token string">&quot;namespace&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;test5.c1&quot;</span>,
		<span class="token string">&quot;indexFilterSet&quot;</span> <span class="token builtin class-name">:</span> false,
		<span class="token string">&quot;parsedQuery&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
				<span class="token string">&quot;<span class="token variable">$eq</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">500</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>,
		<span class="token string">&quot;winningPlan&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;stage&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;COLLSCAN&quot;</span>,
			<span class="token string">&quot;filter&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
				<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;<span class="token variable">$eq</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">500</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>,
			<span class="token string">&quot;direction&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;forward&quot;</span>
		<span class="token punctuation">}</span>,
		<span class="token string">&quot;rejectedPlans&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
	<span class="token punctuation">}</span>,
	<span class="token string">&quot;executionStats&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token comment"># 执行计划相关统计信息</span>
		<span class="token string">&quot;executionSuccess&quot;</span> <span class="token builtin class-name">:</span> true, <span class="token comment"># 执行成功的状态</span>
		<span class="token string">&quot;nReturned&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token comment"># 返回结果集数目</span>
		<span class="token string">&quot;executionTimeMillis&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">55</span>, <span class="token comment"># 执行所需的时间，毫秒</span>
		<span class="token string">&quot;totalKeysExamined&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token comment"># 索引检查的时间</span>
		<span class="token string">&quot;totalDocsExamined&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">100000</span>, <span class="token comment"># 检查文档总数</span>
		<span class="token string">&quot;executionStages&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;stage&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;COLLSCAN&quot;</span>, <span class="token comment"># 索引扫描方式</span>
			<span class="token string">&quot;filter&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token comment"># 过滤条件</span>
				<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;<span class="token variable">$eq</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">500</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>,
			<span class="token string">&quot;nReturned&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token comment"># 返回结果集数目</span>
			<span class="token string">&quot;executionTimeMillisEstimate&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token comment"># 预估的执行时间，毫秒</span>
			<span class="token string">&quot;works&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">100002</span>, <span class="token comment"># 工作单元数，一个查询会被派生为一些小的工作单元</span>
			<span class="token string">&quot;advanced&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token comment"># 优先返回的结果数目</span>
			<span class="token string">&quot;needTime&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">100000</span>,
			<span class="token string">&quot;needYield&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
			<span class="token string">&quot;saveState&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">781</span>,
			<span class="token string">&quot;restoreState&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">781</span>,
			<span class="token string">&quot;isEOF&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
			<span class="token string">&quot;direction&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;forward&quot;</span>, <span class="token comment"># 方向</span>
			<span class="token string">&quot;docsExamined&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">100000</span> <span class="token comment"># 文档检查数目</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>,
	<span class="token string">&quot;serverInfo&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;host&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;hushengdeMacBook-Pro.local&quot;</span>,
		<span class="token string">&quot;port&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">27017</span>,
		<span class="token string">&quot;version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;4.2.6&quot;</span>,
		<span class="token string">&quot;gitVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;20364840b8f1af16917e4c23c1b5f5efd8b352f8&quot;</span>
	<span class="token punctuation">}</span>,
	<span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>age添加索引</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 给age添加索引</span>
db.c1.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>age: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 继续使用上面的查询语句</span>
db.c1.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:500<span class="token punctuation">}</span><span class="token punctuation">)</span>.explain<span class="token punctuation">(</span><span class="token string">'executionStats'</span><span class="token punctuation">)</span>

<span class="token comment"># 输出</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;queryPlanner&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;plannerVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
		<span class="token string">&quot;namespace&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;test5.c1&quot;</span>,
		<span class="token string">&quot;indexFilterSet&quot;</span> <span class="token builtin class-name">:</span> false,
		<span class="token string">&quot;parsedQuery&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
				<span class="token string">&quot;<span class="token variable">$eq</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">500</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>,
		<span class="token string">&quot;winningPlan&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;stage&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;FETCH&quot;</span>,
			<span class="token string">&quot;inputStage&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
				<span class="token string">&quot;stage&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;IXSCAN&quot;</span>,
				<span class="token string">&quot;keyPattern&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
				<span class="token punctuation">}</span>,
				<span class="token string">&quot;indexName&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;age_1&quot;</span>,
				<span class="token string">&quot;isMultiKey&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;multiKeyPaths&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
				<span class="token punctuation">}</span>,
				<span class="token string">&quot;isUnique&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;isSparse&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;isPartial&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;indexVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
				<span class="token string">&quot;direction&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;forward&quot;</span>,
				<span class="token string">&quot;indexBounds&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
						<span class="token string">&quot;[500.0, 500.0]&quot;</span>
					<span class="token punctuation">]</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>,
		<span class="token string">&quot;rejectedPlans&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
	<span class="token punctuation">}</span>,
	<span class="token string">&quot;executionStats&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;executionSuccess&quot;</span> <span class="token builtin class-name">:</span> true,
		<span class="token string">&quot;nReturned&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
		<span class="token string">&quot;executionTimeMillis&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
		<span class="token string">&quot;totalKeysExamined&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
		<span class="token string">&quot;totalDocsExamined&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
		<span class="token string">&quot;executionStages&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;stage&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;FETCH&quot;</span>,
			<span class="token string">&quot;nReturned&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
			<span class="token string">&quot;executionTimeMillisEstimate&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
			<span class="token string">&quot;works&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
			<span class="token string">&quot;advanced&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
			<span class="token string">&quot;needTime&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
			<span class="token string">&quot;needYield&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
			<span class="token string">&quot;saveState&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
			<span class="token string">&quot;restoreState&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
			<span class="token string">&quot;isEOF&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
			<span class="token string">&quot;docsExamined&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
			<span class="token string">&quot;alreadyHasObj&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
			<span class="token string">&quot;inputStage&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
				<span class="token string">&quot;stage&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;IXSCAN&quot;</span>,
				<span class="token string">&quot;nReturned&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
				<span class="token string">&quot;executionTimeMillisEstimate&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
				<span class="token string">&quot;works&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
				<span class="token string">&quot;advanced&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
				<span class="token string">&quot;needTime&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
				<span class="token string">&quot;needYield&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
				<span class="token string">&quot;saveState&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
				<span class="token string">&quot;restoreState&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
				<span class="token string">&quot;isEOF&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
				<span class="token string">&quot;keyPattern&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
				<span class="token punctuation">}</span>,
				<span class="token string">&quot;indexName&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;age_1&quot;</span>,
				<span class="token string">&quot;isMultiKey&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;multiKeyPaths&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
				<span class="token punctuation">}</span>,
				<span class="token string">&quot;isUnique&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;isSparse&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;isPartial&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;indexVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
				<span class="token string">&quot;direction&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;forward&quot;</span>,
				<span class="token string">&quot;indexBounds&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
						<span class="token string">&quot;[500.0, 500.0]&quot;</span>
					<span class="token punctuation">]</span>
				<span class="token punctuation">}</span>,
				<span class="token string">&quot;keysExamined&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
				<span class="token string">&quot;seeks&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
				<span class="token string">&quot;dupsTested&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
				<span class="token string">&quot;dupsDropped&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>,
	<span class="token string">&quot;serverInfo&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;host&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;hushengdeMacBook-Pro.local&quot;</span>,
		<span class="token string">&quot;port&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">27017</span>,
		<span class="token string">&quot;version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;4.2.6&quot;</span>,
		<span class="token string">&quot;gitVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;20364840b8f1af16917e4c23c1b5f5efd8b352f8&quot;</span>
	<span class="token punctuation">}</span>,
	<span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>选择规则（如何选择合适的列创建索引）
<ul><li>为常做条件、排序、分组的字段建立索引</li> <li>选择唯一性索引 （ps. 同值较少如性别字段）</li> <li>选择较小的数据列，为较长的字符串使用前缀索引 （ps. 索引文件更小）</li></ul></li></ul> <hr> <h2 id="_4-权限机制"><a href="#_4-权限机制" class="header-anchor">#</a> 4. 权限机制</h2> <ul><li>问题：直接在窗口输入命令就可以登录到数据库，应该使用权限机制，开启验证模式即可</li></ul> <h3 id="_4-1-创建账号"><a href="#_4-1-创建账号" class="header-anchor">#</a> 4.1 创建账号</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span> 
    <span class="token string">&quot;user&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;用户名&quot;</span>,
    <span class="token string">&quot;pwd&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;密码&quot;</span>,
    <span class="token string">&quot;roles&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>  <span class="token comment"># 置用户的权限</span>
        role: <span class="token string">&quot;角色&quot;</span>, 
        db: <span class="token string">&quot;所属数据库&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-2-角色种类"><a href="#_4-2-角色种类" class="header-anchor">#</a> 4.2 角色种类</h3> <ul><li>超级用户角色：root</li> <li>数据库用户角色：read、readWrite;</li> <li>数据库管理角色：dbAdmin、userAdmin；</li> <li>集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；</li> <li>备份恢复角色：backup、restore；</li> <li>所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</li></ul> <h3 id="_4-3-角色说明"><a href="#_4-3-角色说明" class="header-anchor">#</a> 4.3 角色说明</h3> <ul><li>root：只在admin数据库中可用。超级账号，超级权限；</li> <li>read：允许用户读取指定数据库；</li> <li>readWrite：允许用户读写指定数据库；</li> <li>dbAdmin：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile；</li> <li>dbAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限；</li> <li>clusterAdmin：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限；</li> <li>userAdmin：允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户；</li> <li>userAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限；</li> <li>readAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读权限；</li> <li>readWriteAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读写权限；</li></ul> <h3 id="_4-4-开启验证模式-指用户需要输入账号密码才能登陆使用"><a href="#_4-4-开启验证模式-指用户需要输入账号密码才能登陆使用" class="header-anchor">#</a> 4.4 开启验证模式（指用户需要输入账号密码才能登陆使用）</h3> <h4 id="_1-添加超级管理员"><a href="#_1-添加超级管理员" class="header-anchor">#</a> 1）添加超级管理员</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># admin这个数据库是系统自带的数据库，他的用户可以访问任何其他数据库的数据，也叫做超级管理员</span>
use admin  <span class="token comment"># 2.x 3.x 4.x 前面版本默认是看不到admin没关系 直接选中即可</span>

<span class="token comment"># 添加超级管理员</span>
db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span> 
    <span class="token string">&quot;user&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;admin&quot;</span>,
    <span class="token string">&quot;pwd&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;admin888&quot;</span>,
    <span class="token string">&quot;roles&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> 
        role: <span class="token string">&quot;root&quot;</span>, 
        db: <span class="token string">&quot;admin&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 验证是否添加成功   1 表示验证通过 0表示验证失败</span>
db.auth<span class="token punctuation">(</span><span class="token string">'admin'</span>, <span class="token string">'admin888'</span><span class="token punctuation">)</span>
</code></pre></div><p><br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/6.png" width="600"> <br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/7.png" width="600"></p> <h4 id="_2-退出mongod-使用-auth重新进入mongod"><a href="#_2-退出mongod-使用-auth重新进入mongod" class="header-anchor">#</a> 2）退出mongod,使用--auth重新进入mongod</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> mongod --dbpath<span class="token operator">=</span>/Users/Funky/data --auth
</code></pre></div><h4 id="_3-启动服务-登录测试"><a href="#_3-启动服务-登录测试" class="header-anchor">#</a> 3）启动服务 登录测试</h4> <p><br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/8.png" width="600"></p> <ul><li>登录数据库</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 方式一：a-先登录，b-选择数据库，c-输入db.auth(用户名,密码)</span>
mongo
use admin
db.auth<span class="token punctuation">(</span><span class="token string">'admin'</span>, <span class="token string">'admin888'</span><span class="token punctuation">)</span>

<span class="token comment"># 方式二：mongo 服务器IP地址:端口/数据库 -u 用户名 -p 密码 </span>
mongo admin -u admin -p admin888
mongo <span class="token number">127.0</span>.0.1:27017/admin -u admin -p admin888
</code></pre></div><h3 id="_4-5-练习"><a href="#_4-5-练习" class="header-anchor">#</a> 4.5 练习</h3> <ul><li>准备数据：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>use shop
for<span class="token punctuation">(</span>var <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db.goods.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;goodsName&quot;</span>+i, <span class="token string">&quot;price&quot;</span><span class="token builtin class-name">:</span> i<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="添加用户shop1可以读shop数据库-添加用户shop2可以读写shop数据库"><a href="#添加用户shop1可以读shop数据库-添加用户shop2可以读写shop数据库" class="header-anchor">#</a> 添加用户shop1可以读shop数据库，添加用户shop2可以读写shop数据库</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>use shop

<span class="token comment"># 添加用户shop1可以读shop数据库</span>
db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span> 
    <span class="token string">&quot;user&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;shop1&quot;</span>,
    <span class="token string">&quot;pwd&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;shop888&quot;</span>,
    <span class="token string">&quot;roles&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> 
        role: <span class="token string">&quot;read&quot;</span>, 
        db: <span class="token string">&quot;shop&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 添加用户shop2可以读写shop数据库 </span>
db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span> 
    <span class="token string">&quot;user&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;shop2&quot;</span>,
    <span class="token string">&quot;pwd&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;shop999&quot;</span>,
    <span class="token string">&quot;roles&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> 
        role: <span class="token string">&quot;readWrite&quot;</span>, 
        db: <span class="token string">&quot;shop&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 添加的用户角色数据都会存放在admin的users中，查看</span>
use admin
db.system.users.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.pretty<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 退出</span>
<span class="token builtin class-name">exit</span>
</code></pre></div><ul><li>验证：shop1可读</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>mongo <span class="token number">127.0</span>.0.1:27017/shop -u shop1 -p shop888
</code></pre></div><p><br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/9.png" width="600"></p> <ul><li>验证：shop2验证可读可写</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>mongo <span class="token number">127.0</span>.0.1:27017/shop -u shop2 -p shop999
</code></pre></div><p><br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/10.png" width="600"></p> <h2 id="_5-备份还原"><a href="#_5-备份还原" class="header-anchor">#</a> 5. 备份还原</h2> <h3 id="_5-1-备份数据库-mongodump"><a href="#_5-1-备份数据库-mongodump" class="header-anchor">#</a> 5.1 备份数据库 mongodump</h3> <ul><li><p>导出数据语法：mongodump -h -port -u -p -d -o</p> <ul><li><code>-h</code>：host 服务器IP地址（一般不写 默认本机）</li> <li><code>-port</code>：端口（一般不写 默认27017）</li> <li><code>-u</code>：user   账号</li> <li><code>-p</code>：pwd   密码</li> <li><code>-d</code>：database  数据库（留心：数据库不写则导出全局）</li> <li><code>-o</code>：open   备份到指定目录下</li></ul></li> <li><p>备份所有数据： <code>mongodump -u admin -p admin888 -o ~/Desktop/mongodb</code></p></li> <li><p>备份指定数据：<code>mongodump -u shop1 -p shop888 -d shop -o ~/Desktop/shopbak</code></p></li></ul> <h3 id="_5-2-还原数据库mongorestore"><a href="#_5-2-还原数据库mongorestore" class="header-anchor">#</a> 5.2 还原数据库mongorestore</h3> <ul><li>还原数据语法：mongorestore -h -port -u -p  -d --drop 备份数据目录
<ul><li><code>-h</code>：host 服务器IP地址（一般不写 默认本机）</li> <li><code>-port</code>：端口（一般不写 默认27017）</li> <li><code>-u</code>：user   账号</li> <li><code>-p</code>：pwd   密码</li> <li><code>-d</code>：database  数据库（留心：数据库不写则还原全部数据）</li> <li><code>--drop</code>：先删除数据库再导入</li></ul></li> <li>还原所有数据: mongorestore -u admin -p admin888 --drop ~/Desktop/mongodb</li> <li>还原指定数据: mongorestore -u shop2 -p shop999 -d shop --drop ~/Desktop/shopbak</li></ul> <hr> <h2 id="_6-实战可视化管理工具"><a href="#_6-实战可视化管理工具" class="header-anchor">#</a> 6. 实战可视化管理工具</h2> <h3 id="_6-1-adminmongo-网页端管理工具"><a href="#_6-1-adminmongo-网页端管理工具" class="header-anchor">#</a> 6.1 adminMongo 网页端管理工具</h3> <ul><li>数据库启动成功后，可以在浏览器直接访问 <a href="http://localhost:27017" target="_blank" rel="noopener noreferrer">http://localhost:27017<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>安装与启动adminMongo</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token builtin class-name">cd</span> /usr/local
$ <span class="token function">mkdir</span> adminMongo
$ <span class="token builtin class-name">cd</span> adminMongo
$ <span class="token function">git</span> clone https://github.com/mrvautin/adminMongo
$ <span class="token builtin class-name">cd</span> /usr/local/adminMongo/adminMongo
$ <span class="token function">npm</span> <span class="token function">install</span>
$ <span class="token function">npm</span> start
</code></pre></div><ul><li><p>打开 http://localhost:1234/ 可以看到如下界面：
<br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/11.png" width="600"></p></li> <li><p>连接本地的 MongoDB</p> <ul><li>Connection name：必填项</li> <li>Connection string：<code>mongodb://&lt;user&gt;:&lt;password&gt;@127.0.0.1:&lt;port&gt;/&lt;db&gt;</code>（连接 MongoDB 的规则，其中<code>&lt;user&gt;:&lt;password&gt; &lt;db&gt;</code>可以不填写）</li></ul></li> <li><p>点击 Add connection，就出现：
<br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/12.png" width="600"></p></li> <li><p>点击 Connect 连接，就会出现可视化界面，表示连接成功！
<br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/13.png" width="600"></p></li></ul> <h3 id="_6-2-robo-3t-客户端软件工具"><a href="#_6-2-robo-3t-客户端软件工具" class="header-anchor">#</a> 6.2 Robo 3T 客户端软件工具</h3> <ul><li><a href="https://robomongo.org/download" target="_blank" rel="noopener noreferrer">Robo 3T<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/14.png" width="700"></li></ul> <hr> <h2 id="_7-express与mongoose"><a href="#_7-express与mongoose" class="header-anchor">#</a> 7. express与mongoose</h2> <h3 id="_7-1-mongoose简介-schema-model"><a href="#_7-1-mongoose简介-schema-model" class="header-anchor">#</a> 7.1 mongoose简介(schema&amp;model)</h3> <ul><li>node中提供操作MongoDB的模块，能够通过node语法实现MongoDB数据库增删改查</li> <li>mongoose核心概念：
<ul><li>schema：约束字段/列数据</li> <li>model：模型 对应 集合 用来实现数据的增删改查</li></ul></li> <li><a href="http://mongoosejs.com" target="_blank" rel="noopener noreferrer">英文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://mongoosejs.net" target="_blank" rel="noopener noreferrer">中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="_7-2-mongoose使用"><a href="#_7-2-mongoose使用" class="header-anchor">#</a> 7.2 mongoose使用</h3> <ul><li>安装mongoose</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> ~/Desktop/test
<span class="token function">npm</span> i mongoose
<span class="token function">touch</span> c.js

<span class="token comment"># 编写相关代码以后 执行c.js</span>
node c.js
</code></pre></div><ul><li>在c.js中编写 增</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一、导入模块</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 二、连接数据库  mongodb://user:pass@localhost:port/database</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">'mongodb://shop2:shop999@localhost:27017/shop'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---------------------------------------'</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库连接失败：'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---------------------------------------'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库连接成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 三、设置数据模型（声明是哪个集合，限制字段个数和字段类型）</span>
<span class="token keyword">const</span> model <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    uname<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;funky&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    pwd<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span> Number<span class="token punctuation">}</span><span class="token punctuation">,</span>
    sex<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span> String<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 四、创建实例操作（CURD）</span>
<span class="token comment">// 增 --------------------------------</span>
<span class="token keyword">const</span> insertObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">model</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    uname<span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
    pwd<span class="token operator">:</span> <span class="token string">&quot;admin888&quot;</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    sex<span class="token operator">:</span> <span class="token string">&quot;男&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 方法1：insertObj.save((err) =db.close()) </span>
<span class="token comment">// 方法2（推荐）</span>
insertObj<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'插入失败'</span> <span class="token operator">+</span> err<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>在r.js中编写 读</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 四、创建实例操作（CURD）</span>
<span class="token comment">// 读 --------------------------------</span>
<span class="token comment">// 方法1：model.find/findOne(条件对象, 要显示的字段数据对象, (err, result) =db.close()) </span>
<span class="token comment">// 方法2</span>
model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">// model.find({}).skip(1).limit(1).then(res =&gt; {</span>
<span class="token comment">// model.findOne({}).then(res =&gt; {</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_7-3-使用express进行接口开发"><a href="#_7-3-使用express进行接口开发" class="header-anchor">#</a> 7.3 使用express进行接口开发</h3> <ul><li>安装express</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> ~/Desktop/test
<span class="token function">npm</span> i express
<span class="token function">npm</span> i body-parser
<span class="token function">touch</span> http.js

<span class="token function">mkdir</span> controller
<span class="token builtin class-name">cd</span> controller
<span class="token function">touch</span> stu.js

<span class="token comment"># 编写代码后 执行http.js</span>
node http.js
</code></pre></div><ul><li>编写http.js模块，监听端口成功以后，就可以在浏览器访问：<code>http://localhost:3000</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 引入express模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token comment">// 2. 创建app对象，通过语法express(), 底层原理http模块的createServer</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bodyparser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyparser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extende<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyparser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 3. 路由，语法app.HTTP请求方式（路径，回调函数）</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// send是express用来响应数据</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello, funky'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> stuController <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'/controller/stu'</span><span class="token punctuation">)</span>
<span class="token comment">// 学生添加</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/stu'</span><span class="token punctuation">,</span>stuController<span class="token punctuation">.</span>create<span class="token punctuation">)</span>
<span class="token comment">// 学生列表(可分页 参数：pageno，pagesize)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/stu'</span><span class="token punctuation">,</span>stuController<span class="token punctuation">.</span>index<span class="token punctuation">)</span>

<span class="token comment">// 4. 启动服务监听端口</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><code>/controller/stu.js</code>模块</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 导入模型</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
	createModel<span class="token punctuation">,</span> listModel
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/models/stu'</span><span class="token punctuation">)</span>

<span class="token comment">// 定义处理方法</span>
<span class="token keyword">const</span> <span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// res.send(&quot;this is stu create&quot;)</span>
	<span class="token comment">// 1. 接受数据</span>
	<span class="token keyword">let</span> postData <span class="token operator">=</span> req<span class="token punctuation">.</span>body
	<span class="token comment">// 2. 过滤（忽略）</span>
	<span class="token comment">// 3. 操作数据库</span>
	<span class="token keyword">let</span> rs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createModel</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span>
	<span class="token comment">// 4. 判断返回</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>rs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			meta<span class="token operator">:</span> <span class="token punctuation">{</span>
				state<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
				msg<span class="token operator">:</span> <span class="token string">&quot;添加成功&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			data<span class="token operator">:</span> <span class="token keyword">null</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			meta<span class="token operator">:</span> <span class="token punctuation">{</span>
				state<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
				msg<span class="token operator">:</span> <span class="token string">&quot;添加失败&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			data<span class="token operator">:</span> <span class="token keyword">null</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">index</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// res.send('this is index')</span>
	<span class="token keyword">let</span> getData <span class="token operator">=</span> req<span class="token punctuation">.</span>query
	<span class="token keyword">let</span> skip <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>getData<span class="token punctuation">.</span>pageno<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>getData<span class="token punctuation">.</span>pagesize<span class="token punctuation">)</span>
	<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">listModel</span><span class="token punctuation">(</span>skip<span class="token punctuation">,</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>getData<span class="token punctuation">.</span>pagesize<span class="token punctuation">)</span><span class="token punctuation">)</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			meta<span class="token operator">:</span> <span class="token punctuation">{</span>
				state<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
				msg<span class="token operator">:</span> <span class="token string">&quot;查询成功&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			data<span class="token operator">:</span> data
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 导出成员</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	create<span class="token punctuation">,</span>
	index
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>/models/stu.js</code>模块</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一、导入模块</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 二、连接数据库</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">'mongodb://shop2:shop999@localhost:27017/shop'</span><span class="token punctuation">,</span> 
	<span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
	<span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---------------------------------------'</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库连接失败：'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---------------------------------------'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库连接成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 三、设置数据模型（声明是哪个集合，限制字段个数和字段类型）</span>
<span class="token keyword">const</span> model <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'stu'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    uname<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;funky&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span> Number<span class="token punctuation">}</span><span class="token punctuation">,</span>
    sex<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span> String<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 四、方法</span>
<span class="token keyword">const</span> <span class="token function-variable function">createModel</span> <span class="token operator">=</span> <span class="token parameter">postData</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> insertObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">model</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span>
    <span class="token keyword">return</span>  insertObj<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token keyword">return</span> res
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'插入失败'</span> <span class="token operator">+</span> err<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">listModel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">skip<span class="token punctuation">,</span> limit</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>  model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>skip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token keyword">return</span> res
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'查询失败'</span> <span class="token operator">+</span> err<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 导出成员</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    createModel<span class="token punctuation">,</span>
    listModel
<span class="token punctuation">}</span>
</code></pre></div><p><br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/15.png" width="600"> <br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/16.png" width="600"></p> <hr> <h2 id="_8-实战接口文档开发apidoc"><a href="#_8-实战接口文档开发apidoc" class="header-anchor">#</a> 8. 实战接口文档开发apiDoc</h2> <ul><li><a href="https://apidocjs.com/#configuration" target="_blank" rel="noopener noreferrer">apiDoc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是nodejs中的一个模块，可以快速生成接口文档，前提是写接口的时候把注释加上</li> <li>使用：
<ul><li>下载模块：<code>npm install apidoc -g</code></li> <li>在项目根目录创建apidoc.json文件（仅一次)</li></ul></li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;教学管理系统接口文档&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;接口文档&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Custom apiDoc browser title&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;url&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;http://localhost:3000&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在<code>/controller/stu.js</code>中</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
  * @api {get} /stu 学生模块列表
  * @apiName Add
  * @apiGroup Stu
  *
  * @apiParam {Number} pageno   当前页
  * @apiParam {Number} pagesize 每页显示条数
  *
  * @apiSuccess {String}  meta  状态码&amp;提示信息
  * @apiSuccess {String}  data  数据
  */</span>
<span class="token keyword">const</span> <span class="token function-variable function">index</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// res.send('this is index')</span>
	<span class="token keyword">let</span> getData <span class="token operator">=</span> req<span class="token punctuation">.</span>query
	<span class="token keyword">let</span> skip <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>getData<span class="token punctuation">.</span>pageno<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>getData<span class="token punctuation">.</span>pagesize<span class="token punctuation">)</span>
	<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">listModel</span><span class="token punctuation">(</span>skip<span class="token punctuation">,</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>getData<span class="token punctuation">.</span>pagesize<span class="token punctuation">)</span><span class="token punctuation">)</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			meta<span class="token operator">:</span> <span class="token punctuation">{</span>
				state<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
				msg<span class="token operator">:</span> <span class="token string">&quot;查询成功&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			data<span class="token operator">:</span> data
		<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>生成接口文档:  <code>apidoc -i ./接口注释目录 -o ./接口文档存放目录</code> <ul><li><code>apidoc -i ./controller -o ./doc</code> <br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/database/mongodb/1/17.png" width="600"></li></ul></li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://www.bilibili.com/video/BV1xz4y1X7cE" target="_blank" rel="noopener noreferrer">MongoDB数据库 基础入门到高级<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/funkyblog/server/mongodb/1-mongodb-base/" class="prev">
        【1. Mongodb基础】
      </a></span> <span class="next"><a href="/funkyblog/server/spring/1-spring-ioc/">
        【1. IoC控制反转】
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/funkyblog/assets/js/app.a24b3efd.js" defer></script><script src="/funkyblog/assets/js/2.3aea1f50.js" defer></script><script src="/funkyblog/assets/js/77.bd56a926.js" defer></script>
  </body>
</html>
