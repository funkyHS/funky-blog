<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【3. Nginx配置实例】 | Funky&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/funkyblog/logo.jpg">
    <meta name="description" content="Funky的个人技术博客">
    
    <link rel="preload" href="/funkyblog/assets/css/0.styles.c5671824.css" as="style"><link rel="preload" href="/funkyblog/assets/js/app.a24b3efd.js" as="script"><link rel="preload" href="/funkyblog/assets/js/2.3aea1f50.js" as="script"><link rel="preload" href="/funkyblog/assets/js/91.12c27e63.js" as="script"><link rel="prefetch" href="/funkyblog/assets/js/10.fdb72551.js"><link rel="prefetch" href="/funkyblog/assets/js/100.322ef7c3.js"><link rel="prefetch" href="/funkyblog/assets/js/101.7adabe50.js"><link rel="prefetch" href="/funkyblog/assets/js/102.b672d5b4.js"><link rel="prefetch" href="/funkyblog/assets/js/103.cbd5f57f.js"><link rel="prefetch" href="/funkyblog/assets/js/104.98c6bdcb.js"><link rel="prefetch" href="/funkyblog/assets/js/105.51f7efcb.js"><link rel="prefetch" href="/funkyblog/assets/js/106.bcdfddc5.js"><link rel="prefetch" href="/funkyblog/assets/js/107.000a9752.js"><link rel="prefetch" href="/funkyblog/assets/js/108.92133c7f.js"><link rel="prefetch" href="/funkyblog/assets/js/109.249e3002.js"><link rel="prefetch" href="/funkyblog/assets/js/11.8d7a0728.js"><link rel="prefetch" href="/funkyblog/assets/js/110.a116e6e3.js"><link rel="prefetch" href="/funkyblog/assets/js/111.5d78ef12.js"><link rel="prefetch" href="/funkyblog/assets/js/112.2c266219.js"><link rel="prefetch" href="/funkyblog/assets/js/113.480d3824.js"><link rel="prefetch" href="/funkyblog/assets/js/114.fa1b4ab2.js"><link rel="prefetch" href="/funkyblog/assets/js/115.d65cb78a.js"><link rel="prefetch" href="/funkyblog/assets/js/116.33a2e878.js"><link rel="prefetch" href="/funkyblog/assets/js/117.bbd07ef4.js"><link rel="prefetch" href="/funkyblog/assets/js/118.0dedd5d9.js"><link rel="prefetch" href="/funkyblog/assets/js/119.5a13d359.js"><link rel="prefetch" href="/funkyblog/assets/js/12.84a022d2.js"><link rel="prefetch" href="/funkyblog/assets/js/120.6d8406bc.js"><link rel="prefetch" href="/funkyblog/assets/js/121.1535eb29.js"><link rel="prefetch" href="/funkyblog/assets/js/122.25226b03.js"><link rel="prefetch" href="/funkyblog/assets/js/123.00d7c304.js"><link rel="prefetch" href="/funkyblog/assets/js/124.16802c94.js"><link rel="prefetch" href="/funkyblog/assets/js/125.541331b4.js"><link rel="prefetch" href="/funkyblog/assets/js/126.8eec9a18.js"><link rel="prefetch" href="/funkyblog/assets/js/127.d14ed3d3.js"><link rel="prefetch" href="/funkyblog/assets/js/13.fe7b989e.js"><link rel="prefetch" href="/funkyblog/assets/js/14.06c2893e.js"><link rel="prefetch" href="/funkyblog/assets/js/15.7db30254.js"><link rel="prefetch" href="/funkyblog/assets/js/16.f5c8a3a0.js"><link rel="prefetch" href="/funkyblog/assets/js/17.ee25e8b2.js"><link rel="prefetch" href="/funkyblog/assets/js/18.138ba97b.js"><link rel="prefetch" href="/funkyblog/assets/js/19.7b046ac4.js"><link rel="prefetch" href="/funkyblog/assets/js/20.93aa8f6a.js"><link rel="prefetch" href="/funkyblog/assets/js/21.b422e4c4.js"><link rel="prefetch" href="/funkyblog/assets/js/22.4b4fa0d1.js"><link rel="prefetch" href="/funkyblog/assets/js/23.3135691d.js"><link rel="prefetch" href="/funkyblog/assets/js/24.5ed690d9.js"><link rel="prefetch" href="/funkyblog/assets/js/25.599c60f6.js"><link rel="prefetch" href="/funkyblog/assets/js/26.9388b7c2.js"><link rel="prefetch" href="/funkyblog/assets/js/27.a17039b1.js"><link rel="prefetch" href="/funkyblog/assets/js/28.51a65ac9.js"><link rel="prefetch" href="/funkyblog/assets/js/29.ca8f9960.js"><link rel="prefetch" href="/funkyblog/assets/js/3.90f0fac9.js"><link rel="prefetch" href="/funkyblog/assets/js/30.c93ba89f.js"><link rel="prefetch" href="/funkyblog/assets/js/31.1739efda.js"><link rel="prefetch" href="/funkyblog/assets/js/32.3d6133c5.js"><link rel="prefetch" href="/funkyblog/assets/js/33.ea1b693d.js"><link rel="prefetch" href="/funkyblog/assets/js/34.f5f68409.js"><link rel="prefetch" href="/funkyblog/assets/js/35.fe8276f9.js"><link rel="prefetch" href="/funkyblog/assets/js/36.7dfbbc31.js"><link rel="prefetch" href="/funkyblog/assets/js/37.38292e55.js"><link rel="prefetch" href="/funkyblog/assets/js/38.814bd863.js"><link rel="prefetch" href="/funkyblog/assets/js/39.ff4fbd9f.js"><link rel="prefetch" href="/funkyblog/assets/js/4.bf89a90b.js"><link rel="prefetch" href="/funkyblog/assets/js/40.b78c54dc.js"><link rel="prefetch" href="/funkyblog/assets/js/41.f17fe040.js"><link rel="prefetch" href="/funkyblog/assets/js/42.83583d5d.js"><link rel="prefetch" href="/funkyblog/assets/js/43.deed3fdd.js"><link rel="prefetch" href="/funkyblog/assets/js/44.8033ac93.js"><link rel="prefetch" href="/funkyblog/assets/js/45.78c09822.js"><link rel="prefetch" href="/funkyblog/assets/js/46.dc92e91d.js"><link rel="prefetch" href="/funkyblog/assets/js/47.58c20506.js"><link rel="prefetch" href="/funkyblog/assets/js/48.03e8e813.js"><link rel="prefetch" href="/funkyblog/assets/js/49.51f46791.js"><link rel="prefetch" href="/funkyblog/assets/js/5.f6f2e860.js"><link rel="prefetch" href="/funkyblog/assets/js/50.d62f902a.js"><link rel="prefetch" href="/funkyblog/assets/js/51.2f77c15c.js"><link rel="prefetch" href="/funkyblog/assets/js/52.14d3dba9.js"><link rel="prefetch" href="/funkyblog/assets/js/53.9598cf79.js"><link rel="prefetch" href="/funkyblog/assets/js/54.669e4f25.js"><link rel="prefetch" href="/funkyblog/assets/js/55.aeb878b8.js"><link rel="prefetch" href="/funkyblog/assets/js/56.23f25070.js"><link rel="prefetch" href="/funkyblog/assets/js/57.f048233b.js"><link rel="prefetch" href="/funkyblog/assets/js/58.f3967f69.js"><link rel="prefetch" href="/funkyblog/assets/js/59.62f0670e.js"><link rel="prefetch" href="/funkyblog/assets/js/6.6d922041.js"><link rel="prefetch" href="/funkyblog/assets/js/60.016ba18c.js"><link rel="prefetch" href="/funkyblog/assets/js/61.b5d2cff8.js"><link rel="prefetch" href="/funkyblog/assets/js/62.ac5f87fe.js"><link rel="prefetch" href="/funkyblog/assets/js/63.d9a60137.js"><link rel="prefetch" href="/funkyblog/assets/js/64.b591a667.js"><link rel="prefetch" href="/funkyblog/assets/js/65.e768c8e9.js"><link rel="prefetch" href="/funkyblog/assets/js/66.5f46813d.js"><link rel="prefetch" href="/funkyblog/assets/js/67.02b3f46c.js"><link rel="prefetch" href="/funkyblog/assets/js/68.676ba975.js"><link rel="prefetch" href="/funkyblog/assets/js/69.e031cc98.js"><link rel="prefetch" href="/funkyblog/assets/js/7.7a61e41b.js"><link rel="prefetch" href="/funkyblog/assets/js/70.94a805bd.js"><link rel="prefetch" href="/funkyblog/assets/js/71.281fda5b.js"><link rel="prefetch" href="/funkyblog/assets/js/72.290763cf.js"><link rel="prefetch" href="/funkyblog/assets/js/73.21b036b0.js"><link rel="prefetch" href="/funkyblog/assets/js/74.df7e87b8.js"><link rel="prefetch" href="/funkyblog/assets/js/75.a73c1199.js"><link rel="prefetch" href="/funkyblog/assets/js/76.44658040.js"><link rel="prefetch" href="/funkyblog/assets/js/77.bd56a926.js"><link rel="prefetch" href="/funkyblog/assets/js/78.09a51bc3.js"><link rel="prefetch" href="/funkyblog/assets/js/79.cb143284.js"><link rel="prefetch" href="/funkyblog/assets/js/8.708c7e46.js"><link rel="prefetch" href="/funkyblog/assets/js/80.f134bc8b.js"><link rel="prefetch" href="/funkyblog/assets/js/81.12483621.js"><link rel="prefetch" href="/funkyblog/assets/js/82.e41901b3.js"><link rel="prefetch" href="/funkyblog/assets/js/83.5c039041.js"><link rel="prefetch" href="/funkyblog/assets/js/84.c4c06788.js"><link rel="prefetch" href="/funkyblog/assets/js/85.bced8698.js"><link rel="prefetch" href="/funkyblog/assets/js/86.5315ed66.js"><link rel="prefetch" href="/funkyblog/assets/js/87.4ea61a5c.js"><link rel="prefetch" href="/funkyblog/assets/js/88.aa62f043.js"><link rel="prefetch" href="/funkyblog/assets/js/89.0eb25b80.js"><link rel="prefetch" href="/funkyblog/assets/js/9.e076e28d.js"><link rel="prefetch" href="/funkyblog/assets/js/90.7f136876.js"><link rel="prefetch" href="/funkyblog/assets/js/92.e2ffad27.js"><link rel="prefetch" href="/funkyblog/assets/js/93.a08e3a15.js"><link rel="prefetch" href="/funkyblog/assets/js/94.977d3ede.js"><link rel="prefetch" href="/funkyblog/assets/js/95.f8e1328d.js"><link rel="prefetch" href="/funkyblog/assets/js/96.c119e0f7.js"><link rel="prefetch" href="/funkyblog/assets/js/97.e483280d.js"><link rel="prefetch" href="/funkyblog/assets/js/98.0f1eb7a4.js"><link rel="prefetch" href="/funkyblog/assets/js/99.7813329f.js">
    <link rel="stylesheet" href="/funkyblog/assets/css/0.styles.c5671824.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/funkyblog/" class="home-link router-link-active"><img src="/funkyblog/logo.jpg" alt="Funky's blog" class="logo"> <span class="site-name can-hide">Funky's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/funkyblog/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/funkyblog/flutter/" class="nav-link">
  Flutter
</a></div><div class="nav-item"><a href="/funkyblog/server/" class="nav-link router-link-active">
  Server
</a></div><div class="nav-item"><a href="/funkyblog/web/" class="nav-link">
  Web
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/funkyblog/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/funkyblog/flutter/" class="nav-link">
  Flutter
</a></div><div class="nav-item"><a href="/funkyblog/server/" class="nav-link router-link-active">
  Server
</a></div><div class="nav-item"><a href="/funkyblog/web/" class="nav-link">
  Web
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JDBC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Nginx</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/funkyblog/server/nginx/1-nginx-base/" class="sidebar-link">【1. Nginx基本概念】</a></li><li><a href="/funkyblog/server/nginx/2-nginx-install/" class="sidebar-link">【2. 安装，常用命令，配置文件】</a></li><li><a href="/funkyblog/server/nginx/3-nginx-config/" aria-current="page" class="active sidebar-link">【3. Nginx配置实例】</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_1-nginx配置实例-反向代理实例1" class="sidebar-link">1. Nginx配置实例-反向代理实例1</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_1-1-过程分析" class="sidebar-link">1.1 过程分析</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_1-2-配置域名映射" class="sidebar-link">1.2 配置域名映射</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_1-3-修改mac上nginx的配置文件" class="sidebar-link">1.3 修改mac上nginx的配置文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_2-nginx配置实例-反向代理实例2" class="sidebar-link">2. Nginx配置实例-反向代理实例2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_2-1-修改配置文件" class="sidebar-link">2.1 修改配置文件</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_2-2-location-指令说明" class="sidebar-link">2.2 location 指令说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_3-nginx配置实例-负载均衡" class="sidebar-link">3. Nginx配置实例-负载均衡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_3-1-修改配置文件" class="sidebar-link">3.1 修改配置文件</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_3-2-负载均衡分配策略" class="sidebar-link">3.2 负载均衡分配策略</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_1-轮询" class="sidebar-link" style="padding-left:3rem;">1）轮询</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_2-权重weight" class="sidebar-link" style="padding-left:3rem;">2）权重weight</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_3-ip-hash" class="sidebar-link" style="padding-left:3rem;">3）ip_hash</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_4-fair-第三方" class="sidebar-link" style="padding-left:3rem;">4） fair(第三方)</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_4-nginx配置实例-动静分离" class="sidebar-link">4. Nginx配置实例-动静分离</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_4-1-准备工作" class="sidebar-link">4.1 准备工作</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_4-2-修改nginx配置" class="sidebar-link">4.2 修改nginx配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_5-nginx配置实例-高可用" class="sidebar-link">5. Nginx配置实例-高可用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_5-1-准备工作" class="sidebar-link">5.1 准备工作</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_5-2-keepalived" class="sidebar-link">5.2 keepalived</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_6-nginx配置实例-虚拟主机" class="sidebar-link">6. Nginx配置实例-虚拟主机</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#添加配置" class="sidebar-link">添加配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_7-nginx的原理解析" class="sidebar-link">7. Nginx的原理解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_7-1-mater-和-worker" class="sidebar-link">7.1 mater 和 worker</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_7-2-一个master多个workers-的机制好处" class="sidebar-link">7.2 一个master多个workers 的机制好处</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_7-3-需要设置多少个-worker" class="sidebar-link">7.3 需要设置多少个 worker</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#_7-4-连接数-worker-connection" class="sidebar-link">7.4 连接数 worker_connection</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/nginx/3-nginx-config/#参考" class="sidebar-link">参考</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringSecurity</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#_1-nginx配置实例-反向代理实例1">1. Nginx配置实例-反向代理实例1</a><ul><li><a href="#_1-1-过程分析">1.1 过程分析</a></li><li><a href="#_1-2-配置域名映射">1.2 配置域名映射</a></li><li><a href="#_1-3-修改mac上nginx的配置文件">1.3 修改mac上nginx的配置文件</a></li></ul></li><li><a href="#_2-nginx配置实例-反向代理实例2">2. Nginx配置实例-反向代理实例2</a><ul><li><a href="#_2-1-修改配置文件">2.1 修改配置文件</a></li><li><a href="#_2-2-location-指令说明">2.2 location 指令说明</a></li></ul></li><li><a href="#_3-nginx配置实例-负载均衡">3. Nginx配置实例-负载均衡</a><ul><li><a href="#_3-1-修改配置文件">3.1 修改配置文件</a></li><li><a href="#_3-2-负载均衡分配策略">3.2 负载均衡分配策略</a></li></ul></li><li><a href="#_4-nginx配置实例-动静分离">4. Nginx配置实例-动静分离</a><ul><li><a href="#_4-1-准备工作">4.1 准备工作</a></li><li><a href="#_4-2-修改nginx配置">4.2 修改nginx配置</a></li></ul></li><li><a href="#_5-nginx配置实例-高可用">5. Nginx配置实例-高可用</a><ul><li><a href="#_5-1-准备工作">5.1 准备工作</a></li><li><a href="#_5-2-keepalived">5.2 keepalived</a></li></ul></li><li><a href="#_6-nginx配置实例-虚拟主机">6. Nginx配置实例-虚拟主机</a><ul><li><a href="#添加配置">添加配置</a></li></ul></li><li><a href="#_7-nginx的原理解析">7. Nginx的原理解析</a><ul><li><a href="#_7-1-mater-和-worker">7.1 mater 和 worker</a></li><li><a href="#_7-2-一个master多个workers-的机制好处">7.2 一个master多个workers 的机制好处</a></li><li><a href="#_7-3-需要设置多少个-worker">7.3 需要设置多少个 worker</a></li><li><a href="#_7-4-连接数-worker-connection">7.4 连接数 worker_connection</a></li></ul></li><li><a href="#参考">参考</a></li></ul></div><p></p> <h2 id="_1-nginx配置实例-反向代理实例1"><a href="#_1-nginx配置实例-反向代理实例1" class="header-anchor">#</a> 1. Nginx配置实例-反向代理实例1</h2> <ul><li>实现效果：打开浏览器，在浏览器地址栏输入地址 <code>www.123.com</code>，通过nginx反向代理，最后跳转到本地 <code>http://127.0.0.1:80/</code></li> <li>Mac自带Apache服务器，启动后，在浏览器中访问<a href="http://127.0.0.1:80/" target="_blank" rel="noopener noreferrer">http://127.0.0.1/:80<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，显示It works</li> <li>开启apache:  <code>sudo apachectl start</code></li> <li>重启apache:  <code>sudo apachectl restart</code></li> <li>关闭apache:  <code>sudo apachectl stop</code></li> <li>Apache服务器默认的web根目录在：<code>/Library/WebServer/Documents</code></li> <li>Apache的配置文件在：<code>/etc/apache2</code></li></ul> <h3 id="_1-1-过程分析"><a href="#_1-1-过程分析" class="header-anchor">#</a> 1.1 过程分析</h3> <ul><li>浏览器输入<code>www.123.com</code>，浏览器先到<code>/etc/hosts</code>文件中看有没有相应的配置，如果有对应的配置，那么直接根据配置的映射ip去访问，如果没有对应的域名映射，在进行dns解析</li></ul> <h3 id="_1-2-配置域名映射"><a href="#_1-2-配置域名映射" class="header-anchor">#</a> 1.2 配置域名映射</h3> <ul><li>在<code>/etc/hosts</code>中配置域名的映射</li> <li>使用命令：<code>$ sudo vi /etc/hosts</code></li> <li>然后在hosts中添加<code>127.0.0.1 www.123.com</code></li> <li>此时在浏览器中输入：<code>http://www.123.com:8181/</code>，此时就可以访问到nginx的html页面</li></ul> <h3 id="_1-3-修改mac上nginx的配置文件"><a href="#_1-3-修改mac上nginx的配置文件" class="header-anchor">#</a> 1.3 修改mac上nginx的配置文件</h3> <ul><li><code>/usr/local/etc/nginx/nginx.conf</code>，保存并且重新启动nginx</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>http <span class="token punctuation">{</span>
	<span class="token punctuation">..</span>.
    server <span class="token punctuation">{</span>
        <span class="token comment"># 当我们访问 127.0.0.1:8181/ 那么nginx就会转发到 proxy_pass对应的地址中</span>
        listen       <span class="token number">8181</span><span class="token punctuation">;</span>
        server_name  <span class="token number">127.0</span>.0.1<span class="token punctuation">;</span>
        location / <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
            proxy_pass http://127.0.0.1:80/<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">..</span>.
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/nginx/6.png" width="400"></p> <h2 id="_2-nginx配置实例-反向代理实例2"><a href="#_2-nginx配置实例-反向代理实例2" class="header-anchor">#</a> 2. Nginx配置实例-反向代理实例2</h2> <ul><li>实现效果：使用Nginx反向代理，根据访问的路径跳转到不同端口的服务中
<ul><li>访问 <code>http://127.0.0.1:9001/edu/a.html</code>，转发到<code>127.0.0.1:8080/edu/a.html</code></li> <li>访问 <code>http://127.0.0.1:9001/vod/a.html</code>，转发到<code>127.0.0.1:8081/vod/a.html</code></li></ul></li></ul> <h3 id="_2-1-修改配置文件"><a href="#_2-1-修改配置文件" class="header-anchor">#</a> 2.1 修改配置文件</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">9001</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>
    <span class="token comment">#  ~ /edu/  这个是对应的正则表达式</span>
    location ~ /edu/ <span class="token punctuation">{</span>
        proxy_pass   http://127.0.0.1:8080<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    location ~ /vod/ <span class="token punctuation">{</span>
        proxy_pass   http://127.0.0.1:8081<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-2-location-指令说明"><a href="#_2-2-location-指令说明" class="header-anchor">#</a> 2.2 location 指令说明</h3> <ul><li><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#location" target="_blank" rel="noopener noreferrer">location文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>location <span class="token punctuation">[</span> <span class="token operator">=</span> <span class="token operator">|</span> ~ <span class="token operator">|</span> ~* <span class="token operator">|</span> ^~ <span class="token punctuation">]</span> uri <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>=</code> ：用于不含正则表达式的 uri 前，要求请求字符串与 uri 严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求。</li> <li><code>~</code>：用于表示 uri 包含正则表达式，并且区分大小写。</li> <li><code>~*</code>：用于表示 uri 包含正则表达式，并且不区分大小写。</li> <li><code>^~</code>：用于不含正则表达式的 uri 前，要求 Nginx 服务器找到标识 uri 和请求字符串匹配度最高的 location 后，立即使用此 location 处理请求，而不再使用 location块中的正则 uri 和请求字符串做匹配。</li></ul> <h2 id="_3-nginx配置实例-负载均衡"><a href="#_3-nginx配置实例-负载均衡" class="header-anchor">#</a> 3. Nginx配置实例-负载均衡</h2> <ul><li>实现效果：浏览器地址栏输入地址<code>http://127.0.0.1:80/edu/a.html</code>，负载均衡效果，平均转发到 8081和 8082 端口中。</li></ul> <h3 id="_3-1-修改配置文件"><a href="#_3-1-修改配置文件" class="header-anchor">#</a> 3.1 修改配置文件</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 负载用到的配置</span>
upstream myserver<span class="token punctuation">{</span>
	server <span class="token number">127.0</span>.0.1:8080<span class="token punctuation">;</span>
	server <span class="token number">127.0</span>.0.1:8081<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
		<span class="token comment"># myserver要与上面upstream中名称一样</span>
	    proxy_pass  http://myserver<span class="token punctuation">;</span>
        root   html<span class="token punctuation">;</span>
        index  index.html index.htm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在浏览器中访问<code>http://127.0.0.1:80/edu/a.html</code>，不断刷新，可以看到成功转发到不同的端口中了</li></ul> <h3 id="_3-2-负载均衡分配策略"><a href="#_3-2-负载均衡分配策略" class="header-anchor">#</a> 3.2 负载均衡分配策略</h3> <ul><li>负载均衡（load balance）即是将负载分摊到不同的服务单元，既保证服务的可用性，又保证响应足够快，给用户很好的体验。</li> <li>快速增长的访问量和数据流量催生了各式各样的负载均衡产品，很多专业的负载均衡硬件提供了很好的功能，但却价格不菲，这使得负载均衡软件大受欢迎，nginx 就是其中的一个，在 linux 下有 Nginx、 LVS、 Haproxy 等等服务可以提供负载均衡服务，而且 Nginx 提供了几种分配方式(策略)</li></ul> <h4 id="_1-轮询"><a href="#_1-轮询" class="header-anchor">#</a> 1）轮询</h4> <ul><li>这是Ngnix负载均衡默认分配策略。每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除。</li></ul> <h4 id="_2-权重weight"><a href="#_2-权重weight" class="header-anchor">#</a> 2）权重weight</h4> <ul><li>weight 代表权重，默认为 1，权重越高被分配的客户端越多。指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>upstream myserver<span class="token punctuation">{</span>
	server <span class="token number">127.0</span>.0.1:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
	server <span class="token number">127.0</span>.0.1:8081 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-ip-hash"><a href="#_3-ip-hash" class="header-anchor">#</a> 3）ip_hash</h4> <ul><li>每个请求按访问 ip 的 hash 结果分配，这样每个访客固定访问一个后端服务器，可以解决 session 的问题。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>upstream myserver<span class="token punctuation">{</span>
	ip_hash<span class="token punctuation">;</span>
	server <span class="token number">127.0</span>.0.1:8080<span class="token punctuation">;</span>
	server <span class="token number">127.0</span>.0.1:8081<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-fair-第三方"><a href="#_4-fair-第三方" class="header-anchor">#</a> 4） fair(第三方)</h4> <ul><li>Ngnix负载均衡第三方分配策略。按后端服务器的响应时间来分配请求，响应时间短的优先分配。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>upstream myserver<span class="token punctuation">{</span>
	server <span class="token number">127.0</span>.0.1:8081<span class="token punctuation">;</span>
	server <span class="token number">127.0</span>.0.1:8082<span class="token punctuation">;</span>
	fair<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-nginx配置实例-动静分离"><a href="#_4-nginx配置实例-动静分离" class="header-anchor">#</a> 4. Nginx配置实例-动静分离</h2> <ul><li>Nginx 动静分离简单来说就是把动态跟静态请求分开，不能理解成只是单纯的把动态页面和静态页面物理分离。严格意义上说应该是动态请求跟静态请求分开，可以理解成使用 Nginx 处理静态页面， Tomcat 处理动态页面。动静分离从目前实现角度来讲大致分为两种：
<ul><li>一种是纯粹把静态文件独立成单独的域名，放在独立的服务器上，也是目前主流推崇的方案；</li> <li>另外一种方法就是动态跟静态文件混合在一起发布，通过 nginx 来分开。</li></ul></li> <li>通过 location 指定不同的后缀名实现不同的请求转发。通过 expires 参数设置，可以使浏览器缓存过期时间，减少与服务器之前的请求和流量。具体 Expires 定义：是给一个资源设定一个过期时间，也就是说无需去服务端验证，直接通过浏览器自身确认是否过期即可，所以不会产生额外的流量。此种方法非常适合不经常变动的资源。（如果经常更新的文件，不建议使用 Expires 来缓存）</li> <li>若将其设置 3d，表示在这 3 天之内访问这个 URL，发送一个请求，比对服务器该文件最后更新时间没有变化，则不会从服务器抓取，返回状态码304，如果有修改，则直接从服务器重新下载，返回状态码 200。</li></ul> <h3 id="_4-1-准备工作"><a href="#_4-1-准备工作" class="header-anchor">#</a> 4.1 准备工作</h3> <ul><li>在根目录下创建 <code>/data</code>，然后新建文件<code>/data/www/a.html</code>，<code>/data/image/01.png</code></li></ul> <h3 id="_4-2-修改nginx配置"><a href="#_4-2-修改nginx配置" class="header-anchor">#</a> 4.2 修改nginx配置</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

	<span class="token comment"># 主要配置内容</span>
	location /www/ <span class="token punctuation">{</span>
		root  /data/<span class="token punctuation">;</span>
        index  index.html index.htm<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    location /image/ <span class="token punctuation">{</span>
        root  /data/<span class="token punctuation">;</span>
        autoindex on<span class="token punctuation">;</span> <span class="token comment"># 访问http://127.0.0.1/image/ 可以列出当前文件夹中的文件</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在浏览器中输入地址：<code>http://127.0.0.1/image/</code> 可以列出当前文件夹中的文件</li> <li>在浏览器中输入地址：<code>http://127.0.0.1/image/01.png</code> 访问静态资源</li> <li>在浏览器中输入地址：<code>http://127.0.0.1/www/a.html</code> 访问静态资源</li></ul> <h2 id="_5-nginx配置实例-高可用"><a href="#_5-nginx配置实例-高可用" class="header-anchor">#</a> 5. Nginx配置实例-高可用</h2> <ul><li>为什么要配置nginx高可用？以防单一nginx挂了，另一个nginx能担当重任
<br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/nginx/7.png" width="600"></li> <li>需要两台 nginx 服务器，需要 keepalived，需要虚拟ip(对外部可访问)</li></ul> <h3 id="_5-1-准备工作"><a href="#_5-1-准备工作" class="header-anchor">#</a> 5.1 准备工作</h3> <ul><li>需要两台服务器 192.168.17.129 和 192.168.17.131</li> <li>在两台服务器安装 Nginx</li> <li>在两台服务器安装 keepalived</li></ul> <h3 id="_5-2-keepalived"><a href="#_5-2-keepalived" class="header-anchor">#</a> 5.2 keepalived</h3> <ul><li>在CenterOS中 使用 yum 命令进行安装yum install keepalived –y</li> <li>安装之后，生成目录<code>/etc/keepalived</code>，配置文件：keepalived.conf</li> <li>修改/etc/keepalived/keepalivec.conf配置文件</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>global_defs <span class="token punctuation">{</span> <span class="token comment"># 全局配置</span>
	notification_email <span class="token punctuation">{</span>
		acassen@firewall.loc
		failover@firewall.loc
		sysadmin@firewall.loc
	<span class="token punctuation">}</span>
	notification_email_from Alexandre.Cassen@firewall.loc
	smtp_server <span class="token number">192.168</span>.17.129
	smtp_connect_timeout <span class="token number">30</span>
	router_id LVS_DEVEL <span class="token comment"># 在/etc/hosts中添加的名字：127.0.0.1 LVS_DEVEL    访问到主机</span>
<span class="token punctuation">}</span>

vrrp_script chk_http_port <span class="token punctuation">{</span> <span class="token comment"># 检测脚本配置</span>
	script <span class="token string">&quot;/usr/local/src/nginx_check.sh&quot;</span> 
	interval <span class="token number">2</span> <span class="token comment">#（检测脚本执行的间隔）每隔2s执行一次脚本</span>
	weight -20 <span class="token comment"># 如果脚本中的条件成立，那么就给当前服务器的权重降低20 </span>
<span class="token punctuation">}</span>

vrrp_instance VI_1 <span class="token punctuation">{</span>
	state BACKUP <span class="token comment"># 备份服务器上将 MASTER 改为 BACKUP</span>
	interface ens33 <span class="token comment"># 网卡  在命令行使用 ifconfig，可以看到网卡的名称</span>
	virtual_router_id <span class="token number">51</span> <span class="token comment"># 主、备机的 virtual_router_id 必须相同</span>
	priority <span class="token number">90</span> <span class="token comment"># 主、备机取不同的优先级，主机值较大，备份机值较小</span>
	advert_int <span class="token number">1</span> <span class="token comment"># 每隔1秒发送一个心跳，判断服务器是否还或者</span>
	authentication <span class="token punctuation">{</span> <span class="token comment"># 权限校验</span>
		auth_type PASS <span class="token comment"># 密码是 1111</span>
		auth_pass <span class="token number">1111</span>
	<span class="token punctuation">}</span>
	virtual_ipaddress <span class="token punctuation">{</span>
		<span class="token number">192.168</span>.17.50 <span class="token comment"># VRRP H 虚拟地址</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在<code>/usr/local/src</code>目录下添加检测脚本<code>nginx_check.sh</code></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">A</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> -C nginx – no-header <span class="token operator">|</span><span class="token function">wc</span> -l<span class="token variable">`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$A</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
	/usr/local/nginx/sbin/nginx  <span class="token comment"># nginx启动路径</span>
	<span class="token function">sleep</span> <span class="token number">2</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> -C nginx --no-header <span class="token operator">|</span><span class="token function">wc</span> -l<span class="token variable">`</span></span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
		<span class="token function">killall</span> keepalived
	<span class="token keyword">fi</span>
<span class="token keyword">fi</span>
</code></pre></div><ul><li>把两台服务器上 Nginx 和 keepalived 启动
<ul><li>启动 Nginx： ./nginx</li> <li>启动 keepalived： systemctl start keepalived.service</li></ul></li> <li>测试：
<ul><li>在浏览器地址栏输入 虚拟 ip 地址 192.168.17.50</li> <li>把主服务器（192.168.17.129） Nginx 和 keepalived 停止，再输入 192.168.17.50</li></ul></li></ul> <h2 id="_6-nginx配置实例-虚拟主机"><a href="#_6-nginx配置实例-虚拟主机" class="header-anchor">#</a> 6. Nginx配置实例-虚拟主机</h2> <ul><li>有的网站，由于访问量太小，需要节省成本，将多个网站部署在同一台服务器上。</li> <li>例如将<code>www.aaa.com</code>和<code>www.bbb.com</code>两个网站部署在同一台服务器上，两个域名解析到同一个IP地址，但是用户通过两个域名却可以打开两个完全不同的网站，互相不影响，就像访问两个服务器一样，所以叫两个虚拟主机。</li></ul> <h3 id="添加配置"><a href="#添加配置" class="header-anchor">#</a> 添加配置</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen <span class="token number">80</span> default_server<span class="token punctuation">;</span>
    server_name _<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">444</span><span class="token punctuation">;</span> <span class="token comment"># 过滤其他域名的请求，返回444状态码</span>
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name www.aaa.com<span class="token punctuation">;</span> <span class="token comment"># www.aaa.com域名</span>
    location / <span class="token punctuation">{</span>
        proxy_pass http://localhost:8080<span class="token punctuation">;</span> <span class="token comment"># 对应端口号8080</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name www.bbb.com<span class="token punctuation">;</span> <span class="token comment"># www.bbb.com域名</span>
    location / <span class="token punctuation">{</span>
        proxy_pass http://localhost:8081<span class="token punctuation">;</span> <span class="token comment"># 对应端口号8081</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-nginx的原理解析"><a href="#_7-nginx的原理解析" class="header-anchor">#</a> 7. Nginx的原理解析</h2> <h3 id="_7-1-mater-和-worker"><a href="#_7-1-mater-和-worker" class="header-anchor">#</a> 7.1 mater 和 worker</h3> <p><br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/nginx/8.png" width="600"> <br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/nginx/9.png" width="600"> <br><img src="http://funky_hs.gitee.io/imgcloud/funkyblog/nginx/10.png" width="600"></p> <ul><li>流程说明：
<ul><li>发送请求，先到Nginx中的Master，Master相当于一个管理员，管理员得到任务之后，把任务给下面的Worker</li> <li>Worker通过争抢机制，得到任务，然后可以进行反向代理，用tomcat完成请求的具体操作</li></ul></li></ul> <h3 id="_7-2-一个master多个workers-的机制好处"><a href="#_7-2-一个master多个workers-的机制好处" class="header-anchor">#</a> 7.2 一个master多个workers 的机制好处</h3> <ul><li>可以使用 <code>nginx -s reload</code> 热部署，线上的nginx是不能结束的，使用reload重新加载其他的Work，不影响正在运行的Work</li> <li>对于每个 worker 进程来说，独立的进程，不需要加锁，所以省掉了锁带来的开销，同时在编程以及问题查找时，也会方便很多</li> <li>采用独立的进程，可以让互相之间不会影响，一个进程退出后，其它进程还在工作，服务不会中断， master 进程则很快启动新的worker进程。</li> <li>worker 进程的异常退出，肯定是程序有 bug 了，异常退出，会导致当前 worker 上的所有请求失败，不过不会影响到所有请求，所以降低了风险</li></ul> <h3 id="_7-3-需要设置多少个-worker"><a href="#_7-3-需要设置多少个-worker" class="header-anchor">#</a> 7.3 需要设置多少个 worker</h3> <ul><li>Nginx 同 redis 类似都采用了 io 多路复用机制，每个 worker 都是一个独立的进程，但每个进程里只有一个主线程，通过异步非阻塞的方式来处理请求， 即使是千上万个请求也不在话下。每个 worker 的线程可以把一个 cpu 的性能发挥到极致。</li> <li>所以 worker 数和服务器的cpu数相等是最为适宜的。设少了会浪费 cpu，设多了会造成 cpu 频繁切换上下文带来的损耗。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#设置 worker 数量。</span>
worker_processes <span class="token number">4</span>
<span class="token comment">#work 绑定 cpu(4 work 绑定 4cpu)。</span>
worker_cpu_affinity 0001 0010 0100 <span class="token number">1000</span>
<span class="token comment">#work 绑定 cpu (4 work 绑定 8cpu 中的 4 个) 。</span>
worker_cpu_affinity 0000001 00000010 00000100 00001000
</code></pre></div><h3 id="_7-4-连接数-worker-connection"><a href="#_7-4-连接数-worker-connection" class="header-anchor">#</a> 7.4 连接数 worker_connection</h3> <ul><li><p>发送请求，占用了worker的几个连接数？2个或者4个</p> <ul><li>2个：如果请求的是静态资源，nginx把请求指向静态资源服务器，直接将请求返回了，这样就占用了2个</li> <li>4个：如果nginx要访问tomcat，查询数据库，那么就需要占用4个连接数</li></ul></li> <li><p>nginx有一个master，有四个worker，每个worker支持最大的连接数是1024，支持的最大并发数（work能承受多少个请求）是多少？</p> <ul><li>work最大支持的连接数 4*1024，那么每个work最大的并发数就是 <code>(4*1024)/2</code>或者<code>(4*1024)/4</code></li></ul></li> <li><p><code>连接数</code>是表示每个 worker 进程所能建立连接的最大值，所以，一个 nginx 能建立的最大连接数，应该是 <code>worker_connections * worker_processes</code>。当然，这里说的是最大连接数，对于HTTP请求本地资源来说，能够支持的最大并发数量是worker_connections * worker_processes</p></li> <li><p>如果是支持 <code>http1.1</code> 的浏览器每次访问要占两个连接，所以普通的静态访问最大并发数是：<code>worker_connections * worker_processes /2</code>，</p></li> <li><p>如果是 HTTP 作 为反向代理来说，最大并发数量应该是<code>worker_connections * worker_processes/4</code>。因为作为反向代理服务器，每个并发会建立与客户端的连接和与后端服务的连接，会占用两个连接。</p></li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://www.bilibili.com/video/BV1zJ411w7SV" target="_blank" rel="noopener noreferrer">Nginx教程由浅入深<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/630e2e1ca57f" target="_blank" rel="noopener noreferrer">Nginx从听说到学会<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/funkyblog/server/nginx/2-nginx-install/" class="prev">
        【2. 安装，常用命令，配置文件】
      </a></span> <span class="next"><a href="/funkyblog/server/mysql/1-mysql-install/">
        【1. 安装备份与卸载MySql】
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/funkyblog/assets/js/app.a24b3efd.js" defer></script><script src="/funkyblog/assets/js/2.3aea1f50.js" defer></script><script src="/funkyblog/assets/js/91.12c27e63.js" defer></script>
  </body>
</html>
