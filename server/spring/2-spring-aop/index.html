<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【2. Aop面向切面编程】 | Funky&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/funkyblog/logo.jpg">
    <meta name="description" content="Funky的个人技术博客">
    
    <link rel="preload" href="/funkyblog/assets/css/0.styles.c5671824.css" as="style"><link rel="preload" href="/funkyblog/assets/js/app.a24b3efd.js" as="script"><link rel="preload" href="/funkyblog/assets/js/2.3aea1f50.js" as="script"><link rel="preload" href="/funkyblog/assets/js/94.977d3ede.js" as="script"><link rel="prefetch" href="/funkyblog/assets/js/10.fdb72551.js"><link rel="prefetch" href="/funkyblog/assets/js/100.322ef7c3.js"><link rel="prefetch" href="/funkyblog/assets/js/101.7adabe50.js"><link rel="prefetch" href="/funkyblog/assets/js/102.b672d5b4.js"><link rel="prefetch" href="/funkyblog/assets/js/103.cbd5f57f.js"><link rel="prefetch" href="/funkyblog/assets/js/104.98c6bdcb.js"><link rel="prefetch" href="/funkyblog/assets/js/105.51f7efcb.js"><link rel="prefetch" href="/funkyblog/assets/js/106.bcdfddc5.js"><link rel="prefetch" href="/funkyblog/assets/js/107.000a9752.js"><link rel="prefetch" href="/funkyblog/assets/js/108.92133c7f.js"><link rel="prefetch" href="/funkyblog/assets/js/109.249e3002.js"><link rel="prefetch" href="/funkyblog/assets/js/11.8d7a0728.js"><link rel="prefetch" href="/funkyblog/assets/js/110.a116e6e3.js"><link rel="prefetch" href="/funkyblog/assets/js/111.5d78ef12.js"><link rel="prefetch" href="/funkyblog/assets/js/112.2c266219.js"><link rel="prefetch" href="/funkyblog/assets/js/113.480d3824.js"><link rel="prefetch" href="/funkyblog/assets/js/114.fa1b4ab2.js"><link rel="prefetch" href="/funkyblog/assets/js/115.d65cb78a.js"><link rel="prefetch" href="/funkyblog/assets/js/116.33a2e878.js"><link rel="prefetch" href="/funkyblog/assets/js/117.bbd07ef4.js"><link rel="prefetch" href="/funkyblog/assets/js/118.0dedd5d9.js"><link rel="prefetch" href="/funkyblog/assets/js/119.5a13d359.js"><link rel="prefetch" href="/funkyblog/assets/js/12.84a022d2.js"><link rel="prefetch" href="/funkyblog/assets/js/120.6d8406bc.js"><link rel="prefetch" href="/funkyblog/assets/js/121.1535eb29.js"><link rel="prefetch" href="/funkyblog/assets/js/122.25226b03.js"><link rel="prefetch" href="/funkyblog/assets/js/123.00d7c304.js"><link rel="prefetch" href="/funkyblog/assets/js/124.16802c94.js"><link rel="prefetch" href="/funkyblog/assets/js/125.541331b4.js"><link rel="prefetch" href="/funkyblog/assets/js/126.8eec9a18.js"><link rel="prefetch" href="/funkyblog/assets/js/127.d14ed3d3.js"><link rel="prefetch" href="/funkyblog/assets/js/13.fe7b989e.js"><link rel="prefetch" href="/funkyblog/assets/js/14.06c2893e.js"><link rel="prefetch" href="/funkyblog/assets/js/15.7db30254.js"><link rel="prefetch" href="/funkyblog/assets/js/16.f5c8a3a0.js"><link rel="prefetch" href="/funkyblog/assets/js/17.ee25e8b2.js"><link rel="prefetch" href="/funkyblog/assets/js/18.138ba97b.js"><link rel="prefetch" href="/funkyblog/assets/js/19.7b046ac4.js"><link rel="prefetch" href="/funkyblog/assets/js/20.93aa8f6a.js"><link rel="prefetch" href="/funkyblog/assets/js/21.b422e4c4.js"><link rel="prefetch" href="/funkyblog/assets/js/22.4b4fa0d1.js"><link rel="prefetch" href="/funkyblog/assets/js/23.3135691d.js"><link rel="prefetch" href="/funkyblog/assets/js/24.5ed690d9.js"><link rel="prefetch" href="/funkyblog/assets/js/25.599c60f6.js"><link rel="prefetch" href="/funkyblog/assets/js/26.9388b7c2.js"><link rel="prefetch" href="/funkyblog/assets/js/27.a17039b1.js"><link rel="prefetch" href="/funkyblog/assets/js/28.51a65ac9.js"><link rel="prefetch" href="/funkyblog/assets/js/29.ca8f9960.js"><link rel="prefetch" href="/funkyblog/assets/js/3.90f0fac9.js"><link rel="prefetch" href="/funkyblog/assets/js/30.c93ba89f.js"><link rel="prefetch" href="/funkyblog/assets/js/31.1739efda.js"><link rel="prefetch" href="/funkyblog/assets/js/32.3d6133c5.js"><link rel="prefetch" href="/funkyblog/assets/js/33.ea1b693d.js"><link rel="prefetch" href="/funkyblog/assets/js/34.f5f68409.js"><link rel="prefetch" href="/funkyblog/assets/js/35.fe8276f9.js"><link rel="prefetch" href="/funkyblog/assets/js/36.7dfbbc31.js"><link rel="prefetch" href="/funkyblog/assets/js/37.38292e55.js"><link rel="prefetch" href="/funkyblog/assets/js/38.814bd863.js"><link rel="prefetch" href="/funkyblog/assets/js/39.ff4fbd9f.js"><link rel="prefetch" href="/funkyblog/assets/js/4.bf89a90b.js"><link rel="prefetch" href="/funkyblog/assets/js/40.b78c54dc.js"><link rel="prefetch" href="/funkyblog/assets/js/41.f17fe040.js"><link rel="prefetch" href="/funkyblog/assets/js/42.83583d5d.js"><link rel="prefetch" href="/funkyblog/assets/js/43.deed3fdd.js"><link rel="prefetch" href="/funkyblog/assets/js/44.8033ac93.js"><link rel="prefetch" href="/funkyblog/assets/js/45.78c09822.js"><link rel="prefetch" href="/funkyblog/assets/js/46.dc92e91d.js"><link rel="prefetch" href="/funkyblog/assets/js/47.58c20506.js"><link rel="prefetch" href="/funkyblog/assets/js/48.03e8e813.js"><link rel="prefetch" href="/funkyblog/assets/js/49.51f46791.js"><link rel="prefetch" href="/funkyblog/assets/js/5.f6f2e860.js"><link rel="prefetch" href="/funkyblog/assets/js/50.d62f902a.js"><link rel="prefetch" href="/funkyblog/assets/js/51.2f77c15c.js"><link rel="prefetch" href="/funkyblog/assets/js/52.14d3dba9.js"><link rel="prefetch" href="/funkyblog/assets/js/53.9598cf79.js"><link rel="prefetch" href="/funkyblog/assets/js/54.669e4f25.js"><link rel="prefetch" href="/funkyblog/assets/js/55.aeb878b8.js"><link rel="prefetch" href="/funkyblog/assets/js/56.23f25070.js"><link rel="prefetch" href="/funkyblog/assets/js/57.f048233b.js"><link rel="prefetch" href="/funkyblog/assets/js/58.f3967f69.js"><link rel="prefetch" href="/funkyblog/assets/js/59.62f0670e.js"><link rel="prefetch" href="/funkyblog/assets/js/6.6d922041.js"><link rel="prefetch" href="/funkyblog/assets/js/60.016ba18c.js"><link rel="prefetch" href="/funkyblog/assets/js/61.b5d2cff8.js"><link rel="prefetch" href="/funkyblog/assets/js/62.ac5f87fe.js"><link rel="prefetch" href="/funkyblog/assets/js/63.d9a60137.js"><link rel="prefetch" href="/funkyblog/assets/js/64.b591a667.js"><link rel="prefetch" href="/funkyblog/assets/js/65.e768c8e9.js"><link rel="prefetch" href="/funkyblog/assets/js/66.5f46813d.js"><link rel="prefetch" href="/funkyblog/assets/js/67.02b3f46c.js"><link rel="prefetch" href="/funkyblog/assets/js/68.676ba975.js"><link rel="prefetch" href="/funkyblog/assets/js/69.e031cc98.js"><link rel="prefetch" href="/funkyblog/assets/js/7.7a61e41b.js"><link rel="prefetch" href="/funkyblog/assets/js/70.94a805bd.js"><link rel="prefetch" href="/funkyblog/assets/js/71.281fda5b.js"><link rel="prefetch" href="/funkyblog/assets/js/72.290763cf.js"><link rel="prefetch" href="/funkyblog/assets/js/73.21b036b0.js"><link rel="prefetch" href="/funkyblog/assets/js/74.df7e87b8.js"><link rel="prefetch" href="/funkyblog/assets/js/75.a73c1199.js"><link rel="prefetch" href="/funkyblog/assets/js/76.44658040.js"><link rel="prefetch" href="/funkyblog/assets/js/77.bd56a926.js"><link rel="prefetch" href="/funkyblog/assets/js/78.09a51bc3.js"><link rel="prefetch" href="/funkyblog/assets/js/79.cb143284.js"><link rel="prefetch" href="/funkyblog/assets/js/8.708c7e46.js"><link rel="prefetch" href="/funkyblog/assets/js/80.f134bc8b.js"><link rel="prefetch" href="/funkyblog/assets/js/81.12483621.js"><link rel="prefetch" href="/funkyblog/assets/js/82.e41901b3.js"><link rel="prefetch" href="/funkyblog/assets/js/83.5c039041.js"><link rel="prefetch" href="/funkyblog/assets/js/84.c4c06788.js"><link rel="prefetch" href="/funkyblog/assets/js/85.bced8698.js"><link rel="prefetch" href="/funkyblog/assets/js/86.5315ed66.js"><link rel="prefetch" href="/funkyblog/assets/js/87.4ea61a5c.js"><link rel="prefetch" href="/funkyblog/assets/js/88.aa62f043.js"><link rel="prefetch" href="/funkyblog/assets/js/89.0eb25b80.js"><link rel="prefetch" href="/funkyblog/assets/js/9.e076e28d.js"><link rel="prefetch" href="/funkyblog/assets/js/90.7f136876.js"><link rel="prefetch" href="/funkyblog/assets/js/91.12c27e63.js"><link rel="prefetch" href="/funkyblog/assets/js/92.e2ffad27.js"><link rel="prefetch" href="/funkyblog/assets/js/93.a08e3a15.js"><link rel="prefetch" href="/funkyblog/assets/js/95.f8e1328d.js"><link rel="prefetch" href="/funkyblog/assets/js/96.c119e0f7.js"><link rel="prefetch" href="/funkyblog/assets/js/97.e483280d.js"><link rel="prefetch" href="/funkyblog/assets/js/98.0f1eb7a4.js"><link rel="prefetch" href="/funkyblog/assets/js/99.7813329f.js">
    <link rel="stylesheet" href="/funkyblog/assets/css/0.styles.c5671824.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/funkyblog/" class="home-link router-link-active"><img src="/funkyblog/logo.jpg" alt="Funky's blog" class="logo"> <span class="site-name can-hide">Funky's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/funkyblog/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/funkyblog/flutter/" class="nav-link">
  Flutter
</a></div><div class="nav-item"><a href="/funkyblog/server/" class="nav-link router-link-active">
  Server
</a></div><div class="nav-item"><a href="/funkyblog/web/" class="nav-link">
  Web
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/funkyblog/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/funkyblog/flutter/" class="nav-link">
  Flutter
</a></div><div class="nav-item"><a href="/funkyblog/server/" class="nav-link router-link-active">
  Server
</a></div><div class="nav-item"><a href="/funkyblog/web/" class="nav-link">
  Web
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JDBC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Spring</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/funkyblog/server/spring/1-spring-ioc/" class="sidebar-link">【1. IoC控制反转】</a></li><li><a href="/funkyblog/server/spring/2-spring-aop/" aria-current="page" class="active sidebar-link">【2. Aop面向切面编程】</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_1-动态代理" class="sidebar-link">1. 动态代理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_1-1-基本概念" class="sidebar-link">1.1 基本概念</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_1-2-动态代理实现方式" class="sidebar-link">1.2 动态代理实现方式</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_1-3-动态代理的使用" class="sidebar-link">1.3 动态代理的使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_2-aop面向切面编程" class="sidebar-link">2. Aop面向切面编程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_2-1-aop相关术语" class="sidebar-link">2.1 Aop相关术语</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_2-2-切面有三个关键的要素" class="sidebar-link">2.2 切面有三个关键的要素</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_2-3-aop的技术实现框架" class="sidebar-link">2.3 Aop的技术实现框架</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_3-学习aspectj框架的使用" class="sidebar-link">3. 学习AspectJ框架的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_3-1-切面的执行时间" class="sidebar-link">3.1 切面的执行时间</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_3-2-切面执行的位置" class="sidebar-link">3.2 切面执行的位置</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#_3-3-aspectj框架实现aop" class="sidebar-link">3.3 Aspectj框架实现Aop</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#前置通知-before" class="sidebar-link" style="padding-left:3rem;">前置通知 @Before</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#后置通知-afterreturning" class="sidebar-link" style="padding-left:3rem;">后置通知 @AfterReturning</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#环绕通知-around" class="sidebar-link" style="padding-left:3rem;">环绕通知 @Around</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#异常通知-afterthrowing" class="sidebar-link" style="padding-left:3rem;">异常通知 @AfterThrowing</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#最终通知-after" class="sidebar-link" style="padding-left:3rem;">最终通知 @After</a></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#定义和管理切入点-pointcut" class="sidebar-link" style="padding-left:3rem;">定义和管理切入点 @Pointcut</a></li></ul></li><li class="sidebar-sub-header"><a href="/funkyblog/server/spring/2-spring-aop/#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/funkyblog/server/spring/3-spring-mybatis/" class="sidebar-link">【3. Spring集成MyBatis】</a></li><li><a href="/funkyblog/server/spring/4-spring-transactional/" class="sidebar-link">【4. Spring事务】</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringSecurity</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#_1-动态代理">1. 动态代理</a><ul><li><a href="#_1-1-基本概念">1.1 基本概念</a></li><li><a href="#_1-2-动态代理实现方式">1.2 动态代理实现方式</a></li><li><a href="#_1-3-动态代理的使用">1.3 动态代理的使用</a></li></ul></li><li><a href="#_2-aop面向切面编程">2. Aop面向切面编程</a><ul><li><a href="#_2-1-aop相关术语">2.1 Aop相关术语</a></li><li><a href="#_2-2-切面有三个关键的要素">2.2 切面有三个关键的要素</a></li><li><a href="#_2-3-aop的技术实现框架">2.3 Aop的技术实现框架</a></li></ul></li><li><a href="#_3-学习aspectj框架的使用">3. 学习AspectJ框架的使用</a><ul><li><a href="#_3-1-切面的执行时间">3.1 切面的执行时间</a></li><li><a href="#_3-2-切面执行的位置">3.2 切面执行的位置</a></li><li><a href="#_3-3-aspectj框架实现aop">3.3 Aspectj框架实现Aop</a></li></ul></li><li><a href="#参考">参考</a></li></ul></div><p></p> <hr> <h2 id="_1-动态代理"><a href="#_1-动态代理" class="header-anchor">#</a> 1. 动态代理</h2> <h3 id="_1-1-基本概念"><a href="#_1-1-基本概念" class="header-anchor">#</a> 1.1 基本概念</h3> <ul><li>动态代理：可以在程序的执行过程中，创建代理对象。</li> <li>通过代理对象执行方法，给目标类的方法增加额外的功能（功能增强）</li> <li>动态代理的作用：
<ul><li>在目标类源代码不改变的情况下，增加功能。</li> <li>减少代码的重复</li> <li>专注业务逻辑代码</li> <li>解耦合，让你的业务功能和日志，事务非业务功能分离。</li></ul></li> <li>jdk动态代理实现步骤：
<ul><li>1）创建目标类，SomeServiceImpl目标类，给它的doSome，doOther增加输出时间，事务</li> <li>2）创建InvocationHandler接口的实现类，在这个类实现给目标方法增加功能</li> <li>3）使用jdk中 类Proxy，创建代理对象，实现创建对象的能力</li></ul></li></ul> <h3 id="_1-2-动态代理实现方式"><a href="#_1-2-动态代理实现方式" class="header-anchor">#</a> 1.2 动态代理实现方式</h3> <ul><li>jdk动态代理
<ul><li>使用jdk中的Proxy，Method，InvocationHandler创建代理对象。</li> <li>jdk动态代理要求目标类必须实现接口</li></ul></li> <li>cglib动态代理
<ul><li>第三方的工具库</li> <li>创建代理对象，原理是继承。 通过继承目标类，创建子类。子类就是代理对象。</li> <li>要求目标类不能是final的， 方法也不能是final的</li></ul></li></ul> <h3 id="_1-3-动态代理的使用"><a href="#_1-3-动态代理的使用" class="header-anchor">#</a> 1.3 动态代理的使用</h3> <ul><li>创建接口SomeService.java</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SomeService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doOther</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>创建实现类SomeServiceImpl.java</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SomeService</span><span class="token punctuation">;</span>

<span class="token comment">// 需求：不修改service类的代码，也能增加 输出时间，事务</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SomeService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ==&gt; 想在这里添加执行时间</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行业务方法doSome&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ==&gt; 想在这里执行事务</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doOther</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ==&gt; 想在这里添加执行时间</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行业务方法doOther&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ==&gt; 想在这里执行事务</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>工具类方法 ServiceTools.java</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceTools</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">doLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;非业务方法，方法的执行时间：&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">doTrans</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法执行完毕后，提交事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>动态代理类 MyIncationHandler.java</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>handler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ServiceTools</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyIncationHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>

    <span class="token comment">// 目标对象</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span> <span class="token comment">// SomeServiceImpl类</span>

    <span class="token keyword">public</span> <span class="token class-name">MyIncationHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过代理对象执行方法时，会调用执行这个invoke()</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行了MyIncationHandler中的 invoke()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==方法名称：&quot;</span><span class="token operator">+</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> methodName <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> res <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;doSome&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// doSome 就是JoinPoint：连接点</span>
            <span class="token class-name">ServiceTools</span><span class="token punctuation">.</span><span class="token function">doLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在目标方法之前，输出时间（Aspect切面）</span>
            <span class="token comment">// 执行目标类的方法，通过Method类实现</span>
            res <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SomeServiceImpl.doSome()</span>
            <span class="token class-name">ServiceTools</span><span class="token punctuation">.</span><span class="token function">doTrans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在目标方法之后，提交事务（Aspect切面）</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            res <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SomeServiceImpl.doOther()</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 目标方法的执行结果</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>main方法调试</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>handler<span class="token punctuation">.</span></span><span class="token class-name">MyIncationHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SomeService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">SomeServiceImpl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 使用jdk的Proxy创建代理对象</span>
        <span class="token comment">// 创建目标对象</span>
        <span class="token class-name">SomeService</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SomeServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建InvocationHandler对象</span>
        <span class="token class-name">InvocationHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyIncationHandler</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用Proxy创建代理</span>
        <span class="token class-name">SomeService</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SomeService</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
            target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            handler<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 通过代理执行方法，会调用handle中的invoke()</span>
        proxy<span class="token punctuation">.</span><span class="token function">doSome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===========================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">doOther</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h2 id="_2-aop面向切面编程"><a href="#_2-aop面向切面编程" class="header-anchor">#</a> 2. Aop面向切面编程</h2> <ul><li>Aop（Aspect Orient Programming）面向切面编程，基于动态代理的，可以使用jdk，cglib两种代理方式。</li> <li>Aop就是动态代理的规范化，把动态代理的实现步骤，方式都定义好了，让开发人员用一种统一的方式，使用动态代理。</li> <li>Aspect: 切面，给你的目标类额外增加功能，就是切面。切面的特点： 一般都是非业务方法，独立使用的。</li> <li>怎么理解面向切面编程 ？
<ul><li>1）需要在分析项目功能时，找出切面。</li> <li>2）合理的安排切面的执行时间（在目标方法前， 还是目标方法后）</li> <li>3）合理的安全切面执行的位置，在哪个类，哪个方法增加增强功能</li></ul></li></ul> <h3 id="_2-1-aop相关术语"><a href="#_2-1-aop相关术语" class="header-anchor">#</a> 2.1 Aop相关术语</h3> <ul><li>Aspect：切面，表示增强的功能，给目标类增加的功能，就是切面。 就是一堆代码，完成某个一个功能。一般都是非业务功能，独立使用的。常见的切面功能有日志，事务，统计信息，参数检查，权限验证。</li> <li>JoinPoint：连接点，连接业务方法和切面的位置。 就某类中的业务方法</li> <li>Pointcut：切入点，指多个连接点方法的集合。多个方法</li> <li>目标对象：给哪个类的方法增加功能， 这个类就是目标对象</li> <li>Advice：通知，通知表示切面功能执行的时间。</li></ul> <h3 id="_2-2-切面有三个关键的要素"><a href="#_2-2-切面有三个关键的要素" class="header-anchor">#</a> 2.2 切面有三个关键的要素</h3> <ul><li>切面的功能代码，切面干什么</li> <li>切面的执行位置，使用Pointcut表示切面执行的位置</li> <li>切面的执行时间，使用Advice表示时间，在目标方法之前，还是目标方法之后。</li></ul> <h3 id="_2-3-aop的技术实现框架"><a href="#_2-3-aop的技术实现框架" class="header-anchor">#</a> 2.3 Aop的技术实现框架</h3> <ul><li>Aop的实现：Aop是一个规范，是动态的一个规范化，一个标准</li> <li>1）spring：spring在内部实现了Aop规范，能做Aop的工作。spring主要在事务处理时使用aop。项目开发中很少使用spring的Aop实现。 因为spring的Aop比较笨重。</li> <li>2）aspectJ: 一个开源的专门做Aop的框架。spring框架中集成了aspectj框架，通过spring就能使用aspectj的功能。</li> <li>aspectJ框架实现Aop有两种方式：
<ul><li>a. 使用xml的配置文件，配置全局事务；</li> <li>b. 使用注解，我们在项目中要做Aop功能，一般都使用注解，aspectj有5个注解。</li></ul></li></ul> <hr> <h2 id="_3-学习aspectj框架的使用"><a href="#_3-学习aspectj框架的使用" class="header-anchor">#</a> 3. 学习AspectJ框架的使用</h2> <h3 id="_3-1-切面的执行时间"><a href="#_3-1-切面的执行时间" class="header-anchor">#</a> 3.1 切面的执行时间</h3> <ul><li>这个执行时间在规范中叫做Advice(通知，增强)</li> <li>在aspectj框架中使用注解表示的。也可以使用xml配置文件中的标签
<ul><li>1）@Before</li> <li>2）@AfterReturning</li> <li>3）@Around</li> <li>4）@AfterThrowing</li> <li>5）@After</li></ul></li></ul> <h3 id="_3-2-切面执行的位置"><a href="#_3-2-切面执行的位置" class="header-anchor">#</a> 3.2 切面执行的位置</h3> <ul><li><p>使用的是切入点表达式</p></li> <li><p>AspectJ 定义了专门的表达式用于指定切入点。表达式的原型是:</p> <ul><li><code>execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern) throws-pattern?)</code></li> <li><code>execution(访问权限 方法返回值 方法声明(参数) 异常类型)</code></li> <li><strong>modifiers-pattern</strong> 访问权限类型(public private)</li> <li><strong>ret-type-pattern</strong> 返回值类型(void)</li> <li><strong>declaring-type-pattern</strong> 包名类名</li> <li><strong>name-pattern(param-pattern)</strong> 方法名(参数类型和参数个数)</li> <li><strong>throws-pattern</strong> 抛出异常类型</li> <li><strong>?</strong> 表示可选的部分</li></ul></li> <li><p>切入点表达式要匹配的对象就是目标方法的方法名。所以，execution 表达式中明显就是方法的签名。注意，表达式中各部分间用空格分开。在其中可以使用以下符号:</p> <ul><li><code>*</code>  表示 0至多个任意字符</li> <li><code>..</code> 表示 用在方法参数中，表示任意多个参数。用在包名后，表示当前包及其子包路径</li> <li><code>+</code> 表示 用在类名后，表示当前类及其子类。用在接口后，表示当前接口及其实现类</li></ul></li> <li><p><strong>AspectJ 的切入点表达式</strong></p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">execution</span><span class="token punctuation">(</span><span class="token keyword">public</span> <span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span>任意公共方法。

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> set<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span>任何一个以“set”开始的方法。

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span>定义在 service 包里的任意类的任意方法。

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span>定义在 service 包或者子包里的任意类的任意方法。“<span class="token punctuation">.</span><span class="token punctuation">.</span>”出现在类名中时，后 面必须跟“<span class="token operator">*</span>”，表示包、子包下的所有类。

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定所有包下的 serivce 子包下所有类<span class="token punctuation">(</span>接口<span class="token punctuation">)</span>中所有方法为切入点

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定只有一级包下的 serivce 子包下所有类<span class="token punctuation">(</span>接口<span class="token punctuation">)</span>中所有方法为切入点

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span>ISomeService<span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定只有一级包下的 <span class="token class-name">ISomeSerivce</span> 接口中所有方法为切入点

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span>ISomeService<span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定所有包下的 <span class="token class-name">ISomeSerivce</span> 接口中所有方法为切入点

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span>IAccountService</span><span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span><span class="token class-name">IAccountService</span> 接口中的任意方法。

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span>IAccountService</span><span class="token operator">+</span><span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span><span class="token class-name">IAccountService</span>
        若为接口，则为接口中的任意方法及其所有实现类中的任意 方法<span class="token punctuation">;</span>
        若为类，则为该类及其子类中的任意方法。

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span>所有的 <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">)</span>方法，
        且 <span class="token function">joke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法的第一个参数是 <span class="token class-name">String</span>，
        第二个参 数是 <span class="token keyword">int</span>。
        如果方法中的参数类型是 java<span class="token punctuation">.</span>lang 包下的类，可以直接使用类名，
        否则必须使用 全限定类名，如 <span class="token function">joke</span><span class="token punctuation">(</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>List</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span>。

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span>所有的 <span class="token function">joke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法，该方法第一个参数为 <span class="token class-name">String</span>，
        第二个参数可以是任意类 型，
        如<span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span><span class="token class-name">String</span> s2<span class="token punctuation">)</span>和<span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span><span class="token keyword">double</span> d2<span class="token punctuation">)</span>都是，
        但<span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span><span class="token keyword">double</span> d2<span class="token punctuation">,</span><span class="token class-name">String</span> s3<span class="token punctuation">)</span>不是。

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span>所有的 <span class="token function">joke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法，该方法第一个参数为 <span class="token class-name">String</span>，
        后面可以有任意个参数且 参数类型不限，
        如 <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">)</span>、<span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span><span class="token class-name">String</span> s2<span class="token punctuation">)</span>和
        <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span><span class="token keyword">double</span> d2<span class="token punctuation">,</span><span class="token class-name">String</span> s3<span class="token punctuation">)</span> 都是。

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span>所有的 <span class="token function">joke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法，方法拥有一个参数，且参数是 <span class="token class-name">Object</span> 类型。
        <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> ob<span class="token punctuation">)</span> 是，但，<span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span>与 <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">User</span> u<span class="token punctuation">)</span>均不是。

<span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        指定切入点为<span class="token operator">:</span>所有的 <span class="token function">joke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法，方法拥有一个参数，且参数是 <span class="token class-name">Object</span> 类型或该类的子类。
        不仅 <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> ob<span class="token punctuation">)</span>是，<span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span>和 <span class="token function">joke</span><span class="token punctuation">(</span><span class="token class-name">User</span> u<span class="token punctuation">)</span>也是。
</code></pre></div><h3 id="_3-3-aspectj框架实现aop"><a href="#_3-3-aspectj框架实现aop" class="header-anchor">#</a> 3.3 Aspectj框架实现Aop</h3> <ul><li>使用aop：目的是给已经存在的一些类和方法，增加额外的功能。前提是不改变原来的类的代码</li> <li>使用aspectj实现aop的基本步骤</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>使用aspectj实现aop的基本步骤：
<span class="token number">1</span> 新建maven项目
<span class="token number">2</span> 加入依赖
    spring依赖
    aspectj依赖
    junit单元测试
<span class="token number">3</span> 创建目标类：接口和他的实现类
    要做的是给类中的方法增加功能
<span class="token number">4</span> 创建切面类：普通类
    <span class="token number">1</span>）在类的上面加入<span class="token annotation punctuation">@Aspect</span>
    <span class="token number">2</span>）在类中定义方法，方法就是切面要执行的功能代码，
        在方法的上面加入aspectj中的通知注释，例如<span class="token annotation punctuation">@Before</span>
        有需要指定切入点表达式<span class="token function">execution</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">5</span> 创建spring配置文件：声明对象，把对象交给容器统一管理
    声明对象你可以使用注解或者xml配置文件<span class="token generics"><span class="token punctuation">&lt;</span>bean<span class="token punctuation">&gt;</span></span>
    <span class="token number">1</span>）声明目标对象
    <span class="token number">2</span>）声明切面类对象
    <span class="token number">3</span>）声明aspectj框架中的自动代理生成器标签。
        自动代理生成器：用来完成代理对象的自动创建功能的
<span class="token number">6</span> 创建测试类，从spring容器中获取目标对象（实际就是代理对象）
    通过代理执行方法，实现aop的功能增强。
</code></pre></div><ul><li>pom.xml</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--junit测试依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--spring依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.2.5.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--aspectj依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-aspects<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.2.5.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>接口类SomeService.java</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>ba01</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SomeService</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 演示 前置通知 @Before</span>
    <span class="token keyword">void</span> <span class="token function">doSome</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token class-name">Integer</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. 演示 后置通知 @AfterReturning</span>
    <span class="token class-name">String</span> <span class="token function">doOther</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 演示 环绕通知 @Around</span>
    <span class="token class-name">String</span> <span class="token function">doFirst</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. 演示 异常通知 @AfterThrowing</span>
    <span class="token keyword">void</span> <span class="token function">doSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 5. 演示 最终通知 @After</span>
    <span class="token keyword">void</span> <span class="token function">doThird</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 6. 演示 @Pointcut</span>
    <span class="token keyword">void</span> <span class="token function">doFour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>实现类 SomeServiceImpl.java（目标类）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>funky<span class="token punctuation">.</span>ba01</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SomeService</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 演示 前置通知 @Before</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSome</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ==&gt; 在这里，想在不改变原有代码的基础上，输出方法的执行时间</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=====目标方法doSome()====&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 演示 后置通知 @AfterReturning</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doOther</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=====目标方法doOther()====&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;abcd&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3. 演示 环绕通知 @Around</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doFirst</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=====目标方法doFirst()====&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;doFirst&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 4. 演示 异常通知 @AfterThrowing</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=====目标方法doSecond()====&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 5. 演示 最终通知 @After</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doThird</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=====目标方法doThird()====&quot;</span><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 6. 演示 @Pointcut</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=====目标方法doFour()====&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>spring config，applicationContext.xml</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span> 
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/aop<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/aop
       https://www.springframework.org/schema/aop/spring-aop.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--把对象交给spring容器，由spring容器统一创建，管理对象--&gt;</span>
    <span class="token comment">&lt;!--声明目标对象--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>someService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.funky.ba01.SomeServiceImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--声明切面类对象--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myAspect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.funky.ba01.MyAspect<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--声明自动代理生成器：使用aspectj框架内部的功能，创建目标对象的代理对象
        创建代理对象是在内存中实现的，修改目标对象的内存中的结构。创建为代理对象
        所以目标对象就是被修改后的代理对象
        aspectj-autoproxy：会把spring容器中的所有的目标对象，一次性都生成代理对象--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--目标类如果没有接口SomeServer，使用cglib动态代理，spring框架会自动用cglib
        如果你期望目标类有接口，也使用cglib代理
        proxy-target-class=&quot;true&quot;:告诉框架，要使用cglib动态代理--&gt;</span>
    <span class="token comment">&lt;!-- &lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot;/&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>切面类MyAspect.java，用来给业务方法增加功能的类</li></ul> <h4 id="前置通知-before"><a href="#前置通知-before" class="header-anchor">#</a> 前置通知 @Before</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
    @Aspect：是aspectj框架中的注解
        作用：表示当前类是切面类。
        切面类：是用来给业务方法增加功能的类，在这个类中有切面的功能代码
        位置：在类定义的上面
*/</span>

<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{</span>

    <span class="token comment">/**********************************************************/</span>
    <span class="token comment">// 1. 前置通知 @Before</span>

    <span class="token comment">/*
        定义方法，方法是实现切面功能的。
        方法的定义要求：
            1 公共方法public
            2 方法没有返回值
            3 方法名称自定义
            4 方法可以有参数，也可以没有参数
                如果有参数，参数不是自定义的，有几个参数类型可以使用
    */</span>
    <span class="token comment">/*
        @Before：前置通知注释
            属性：value，是切入点表达式，表示切面的功能执行的位置
            位置：在方法的上面
        特点：
            1 在目标方法之前先执行的
            2 不会改变目标方法的执行结果
            3 不会影响目标方法的执行
        execution(访问权限 方法返回值 包名类名?方法名(参数类型和参数个数) 异常类型)
    */</span>

    <span class="token comment">// 方式一：@Before(value=&quot;execution(public void com.funky.ba01.SomeServiceImpl.doSome(String,Integer))&quot;)</span>
    <span class="token comment">// 方式二：@Before(value=&quot;execution(void com.funky.ba01.SomeServiceImpl.doSome(String,Integer))&quot;)</span>
    <span class="token comment">// 方式三：@Before(value=&quot;execution(void *..SomeServiceImpl.doSome(String,Integer))&quot;)</span>
    <span class="token comment">// 方式四：@Before(value=&quot;execution(* *..SomeServiceImpl.doSome(..))&quot;)</span>
    <span class="token comment">// 方式五：@Before(value=&quot;execution(* *..SomeServiceImpl.do*(..))&quot;)</span>
    <span class="token comment">// 方式六：@Before(value=&quot;execution(* do*(..))&quot;) // 表示do开头的所有方法</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;execution(* *..SomeServiceImpl.doSome(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myBefore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 就是你切面要执行的功能代码</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;1===前置通知，切面功能：在目标方法之前输出执行时间：&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
        指定通知方法中的参数：JoinPoint
        JoinPoint：业务方法，要加入切面功能的业务方法
            作用：可以在通知方法中获取方法执行时的信息。例如方法名称，方法的实参。
            如果你的切面功能中需要用到方法的信息，就加入JoinPoint
            这个JoinPoint参数的值是由框架赋予，必须是第一个位置的参数
     */</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;execution(void *..SomeServiceImpl.doSome(String,Integer))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myBefore2</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> jp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取方法的完整定义</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2===方法的签名（定义）=&quot;</span> <span class="token operator">+</span> jp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2===方法的名称=&quot;</span><span class="token operator">+</span>jp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取方法的实参</span>
        <span class="token class-name">Object</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> jp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> arg<span class="token operator">:</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;参数=&quot;</span><span class="token operator">+</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 就是你切面要执行的功能代码</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2===前置通知，切面功能：在目标方法之前输出执行时间：&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="后置通知-afterreturning"><a href="#后置通知-afterreturning" class="header-anchor">#</a> 后置通知 @AfterReturning</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{</span>

    <span class="token comment">/**********************************************************/</span>
    <span class="token comment">// 2. 后置通知 @AfterReturning</span>

    <span class="token comment">/*
        后置通知定义方法，方法是实现切面功能的。
        方法的定义要求：
            1 公共方法public
            2 方法没有返回值
            3 方法名称自定义
            4 方法有参数的
    */</span>
    <span class="token comment">/*
        @AfterReturning：后置通知
            属性：1. value，是切入点表达式，表示切面的功能执行的位置
                 2. returning 自定义变量，表示目标方法的返回值的。
                    自定义变量名必须和通知方法的形参名一样。
            位置：在方法定义的上面
            特点：
                1. 在目标方法之后执行的
                2. 能够获取到目标方法的返回值，可以根据这个返回值做不同的处理逻辑
                    Object res = doOther();
                3. 可以修改这个返回值
    */</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* *..SomeServiceImpl.doOther(..))&quot;</span><span class="token punctuation">,</span> returning <span class="token operator">=</span> <span class="token string">&quot;res&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myAfterReturning</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> jp<span class="token punctuation">,</span> <span class="token class-name">Object</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取方法的完整定义</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;后置通知，方法的签名（定义）=&quot;</span> <span class="token operator">+</span> jp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;后置通知，方法的名称=&quot;</span><span class="token operator">+</span>jp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Object res: 是目标方法执行后的返回值，根据返回值做你的切面的功能处理</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;后置通知：在目标方法之后执行的，获取的返回值是：&quot;</span><span class="token operator">+</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;abcd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="环绕通知-around"><a href="#环绕通知-around" class="header-anchor">#</a> 环绕通知 @Around</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{</span>
    <span class="token comment">/**********************************************************/</span>
    <span class="token comment">// 3. 环绕通知 @Around</span>
    <span class="token comment">/*
        环绕通知方法的定义格式
            1 公共方法public
            2 必须有一个返回值，推荐使用Object
            3 方法名称自定义
            4 方法有参数，固定参数ProceedingJoinPoint
    */</span>
    <span class="token comment">/*
        @Around：环绕通知
            属性：1. value，是切入点表达式，表示切面的功能执行的位置
            位置：在方法定义的上面
            特点：
                1. 它是功能最强的通知
                2. 在目标方法的前和后都能增强功能
                3. 控制目标方法是否被调用执行
                4. 修改原来的目标方法的执行结果。影响最后的调用结果

            环绕通知，等同于jdk动态代理的 InvocationHandler接口

            参数：ProceedingJoinPoint 就等同于Method
                作用：执行目标方法的
            返回值：就是目标方法的执行结果，可以被修改

            环绕通知：经常做事务，在目标方法之前开启事务，执行目标方法，在目标方法之后提交事务
    */</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;execution(* *..SomeServiceImpl.doFirst(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">myAround</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取第一个参数的值</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> arg <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>arg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 实现环绕通知</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;环绕通知：在目标方法之前，输出时间：&quot;</span><span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1 目标方法的调用</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 符合条件，调用目标方法</span>
            result <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// method.invoke(); Object result = doFirst();</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;环绕通知：在目标方法之后，提交事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2 在目标方法的前或者后加入功能</span>

        <span class="token comment">// 　修改目标方法的执行结果，影响方法最后的调用结果</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 返回目标方法的执行结果</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="异常通知-afterthrowing"><a href="#异常通知-afterthrowing" class="header-anchor">#</a> 异常通知 @AfterThrowing</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{</span>
    <span class="token comment">/**********************************************************/</span>
    <span class="token comment">// 4. 异常通知 @AfterThrowing</span>

    <span class="token comment">/*
        异常通知方法的定义格式
            1 公共方法public
            2 没有返回值
            3 方法名称自定义
            4 方法有一个Exception，如果还有是JoinPoint，
    */</span>
    <span class="token comment">/*
        @AfterThrowing：异常通知
            属性：1 value 切入点表达式
                 2 throwing 自定义的变量，表示目标方法抛出的异常对象。
                    变量名必须和方法的参数名一样
            特点：
                1 在目标方法抛出异常时执行的
                2 可以做异常的监控程序，监控目标方法执行时是不是有异常
                    如果有异常，可以发送邮件或者短信进行通知
             执行就是：
                 try {
                    SomeServiceImpl.doSecond(..);
                 } catch(Exception e) {
                    myAfterThrowing(e);
                 }
    */</span>

    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* *..SomeServiceImpl.doSecond(..))&quot;</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">&quot;ex&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myAfterThrowing</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;异常通知，方法发生异常时，执行：&quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 发送邮件，短信，通知开发人员</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="最终通知-after"><a href="#最终通知-after" class="header-anchor">#</a> 最终通知 @After</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{</span>
    <span class="token comment">/**********************************************************/</span>
    <span class="token comment">// 5. 最终通知 @After</span>

    <span class="token comment">/*
        最终通知方法的定义格式
            1 公共方法public
            2 没有返回值
            3 方法名称自定义
            4 方法没有参数，如果还有是JoinPoint，
    */</span>
    <span class="token comment">/*
        @After：最终通知
            属性：value 切入点表达式
            位置：在方法的上面
            特点：
                1 总是会执行
                2 在目标方法之后执行的

            执行就是：
                 try {
                    SomeServiceImpl.doThird(..);
                 } catch(Exception e) {

                 } finally {
                    myAfter();
                 }
    */</span>

    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* *..SomeServiceImpl.doThird(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myAfterFinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行最终通知，总是会被执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一般做资源清除工作的</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="定义和管理切入点-pointcut"><a href="#定义和管理切入点-pointcut" class="header-anchor">#</a> 定义和管理切入点 @Pointcut</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{</span>
    <span class="token comment">/**********************************************************/</span>
    <span class="token comment">// 6. 定义和管理切入点 @Pointcut</span>

    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;mypt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myAfterFinalFour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行最终通知，总是会被执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一般做资源清除工作的</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;mypt()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myBeforeFour</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;前置通知，在目标方法之前先执行的&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
        @Pointcut：定义和管理切入点，如果你的项目中有多个切入点表达式是重复的，可以复用的。
                    可以使用 @Pointcut
              属性：value 切入点表达式
              位置：在自定义的方法上面
              特点：当使用@Pointcut定义在一个方法的上面，此时这个方法的名称就是切入点表达式的别名
                其他的通知中，value属性就可以使用这个方法名称，代替切入点表达式了
       如下：mypt() 就是 execution(* *..SomeServiceImpl.doFour(..)) 的别名
    */</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* *..SomeServiceImpl.doFour(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">mypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 无需代码</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>测试类</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTest01</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> config <span class="token operator">=</span> <span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从容器中获取目标对象</span>
        <span class="token class-name">SomeService</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SomeService</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;someService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// proxy:com.sun.proxy.$Proxy8 jdk的动态代理</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy:&quot;</span><span class="token operator">+</span>proxy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 通过代理的对象执行方法，实现目标方法执行时，增强了功能</span>
        proxy<span class="token punctuation">.</span><span class="token function">doSome</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> config <span class="token operator">=</span> <span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从容器中获取目标对象</span>
        <span class="token class-name">SomeService</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SomeService</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;someService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 通过代理的对象执行方法，实现目标方法执行时，增强了功能</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">doOther</span><span class="token punctuation">(</span><span class="token string">&quot;zs&quot;</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;str=&quot;</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> config <span class="token operator">=</span> <span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从容器中获取目标对象</span>
        <span class="token class-name">SomeService</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SomeService</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;someService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 通过代理的对象执行方法，实现目标方法执行时，增强了功能</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">doFirst</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;str====&quot;</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> config <span class="token operator">=</span> <span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从容器中获取目标对象</span>
        <span class="token class-name">SomeService</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SomeService</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;someService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 通过代理的对象执行方法，实现目标方法执行时，增强了功能</span>
        proxy<span class="token punctuation">.</span><span class="token function">doSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test05</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> config <span class="token operator">=</span> <span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从容器中获取目标对象</span>
        <span class="token class-name">SomeService</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SomeService</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;someService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 通过代理的对象执行方法，实现目标方法执行时，增强了功能</span>
        proxy<span class="token punctuation">.</span><span class="token function">doThird</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test06</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> config <span class="token operator">=</span> <span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从容器中获取目标对象</span>
        <span class="token class-name">SomeService</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SomeService</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;someService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 通过代理的对象执行方法，实现目标方法执行时，增强了功能</span>
        proxy<span class="token punctuation">.</span><span class="token function">doFour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test07</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> config <span class="token operator">=</span> <span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从容器中获取目标对象</span>
        <span class="token class-name">SomeServiceImpl</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SomeServiceImpl</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;someService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
            如果目标类SomeServiceImpl没有实现接口，使用的是cglib动态代理，spring框架会自动应用cglib
        */</span>

        <span class="token comment">// 通过代理的对象执行方法，实现目标方法执行时，增强了功能</span>
        proxy<span class="token punctuation">.</span><span class="token function">doThird</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://www.bilibili.com/video/BV1nz4y1d7uy" target="_blank" rel="noopener noreferrer">Spring框架从入门到精通<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/funkyblog/server/spring/1-spring-ioc/" class="prev">
        【1. IoC控制反转】
      </a></span> <span class="next"><a href="/funkyblog/server/spring/3-spring-mybatis/">
        【3. Spring集成MyBatis】
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/funkyblog/assets/js/app.a24b3efd.js" defer></script><script src="/funkyblog/assets/js/2.3aea1f50.js" defer></script><script src="/funkyblog/assets/js/94.977d3ede.js" defer></script>
  </body>
</html>
